{"kind":"article","metadata":{"platforms":[{"introducedAt":"2023.10.21","name":"Brunow"}],"title":"Here Be Dragons: iOS Snapshot Testing Edition","modules":[{"name":"Brunow"}],"images":[{"type":"card","identifier":"misrenderedSwiftUIList.png"}],"color":{"standardColorIdentifier":"purple"}},"schemaVersion":{"major":0,"minor":3,"patch":0},"sections":[],"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/Brunow\/documentation\/Brunow\/10-21-here-be-dragons-snapshot-testing-edition"},"topicSectionsStyle":"detailedGrid","primaryContentSections":[{"kind":"content","content":[{"text":"Backstory","level":2,"type":"heading","anchor":"Backstory"},{"style":"note","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":""},{"type":"reference","isActive":true,"identifier":"https:\/\/en.wikipedia.org\/wiki\/Here_be_dragons"}]}],"type":"aside","name":"In case you are unfamiliar"},{"type":"paragraph","inlineContent":[{"type":"text","text":"As I mentioned "},{"identifier":"doc:\/\/Brunow\/documentation\/Brunow\/08-30-snapshot-testing-with-xcode-cloud","type":"reference","overridingTitle":"in my previous blog post","isActive":true,"overridingTitleInlineContent":[{"text":"in my previous blog post","type":"text"}]},{"text":"","type":"text"},{"type":"text","text":" "},{"text":"I am working on a small side-project app that allows me to play with some tools","type":"text"},{"type":"text","text":" "},{"type":"text","text":"from the Apple software development ecosystem. In that blog post I talked about"},{"text":" ","type":"text"},{"type":"text","text":"the steps needed to get the Swift Snapshot Testing library working with Xcode"},{"text":" ","type":"text"},{"text":"Cloud but that was only the beginning of my snapshot testing saga. It seemed","type":"text"},{"type":"text","text":" "},{"type":"text","text":"like every time I wanted to take a snapshot of a new view I bumped up against"},{"type":"text","text":" "},{"text":"another problem. In this post I’m going to talk through what I bumped up","type":"text"},{"text":" ","type":"text"},{"text":"against, the reasons why this very good library still has those rough bits, and","type":"text"},{"text":" ","type":"text"},{"text":"how I will improve the situation for myself and my team by making opinionated","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"choices."}]},{"type":"aside","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"While I will discuss some pain points when using the "},{"type":"reference","identifier":"https:\/\/github.com\/pointfreeco\/swift-snapshot-testing","isActive":true},{"text":",","type":"text"},{"type":"text","text":" "},{"text":"I cannot emphasize enough how good I think the library is. Hopefully","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"none of the things I say will lead anyone reading this to any other opinion."}]}],"style":"note","name":"Note"},{"anchor":"A-Little-Background-on-Snapshot-Testing","text":"A Little Background on Snapshot Testing","type":"heading","level":2},{"type":"paragraph","inlineContent":[{"text":"Snapshot testing is a type of automated test where you provide an input to the","type":"text"},{"type":"text","text":" "},{"text":"snapshot assertion method, that snapshot assertion method creates a value for","type":"text"},{"type":"text","text":" "},{"type":"text","text":"that input, and then checks to ensure that that value matches the previous"},{"text":" ","type":"text"},{"isActive":true,"identifier":"https:\/\/softwareengineering.stackexchange.com\/a\/358792","type":"reference"},{"type":"text","text":" value for"},{"type":"text","text":" "},{"type":"text","text":"that input."}]},{"type":"paragraph","inlineContent":[{"text":"This blog post is about snapshot testing where the input is a view","type":"text"},{"type":"text","text":" "},{"text":"and the value created by the snapshot assertion method is an image. If I provide","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"a view for my app I expect an image that looks just like a screenshot of my app."}]},{"text":"Some initial pain points","level":2,"type":"heading","anchor":"Some-initial-pain-points"},{"inlineContent":[{"text":"I’ll start by talking through some of the painful things I’ve run into and hope","type":"text"},{"type":"text","text":" "},{"type":"text","text":"that they give a sense of the landscape that I’m dealing with when doing"},{"text":" ","type":"text"},{"type":"text","text":"something that sounds simple like “just add snapshot tests”. All this pain"},{"type":"text","text":" "},{"type":"text","text":"happened over a single week around a month ago."}],"type":"paragraph"},{"type":"heading","text":"Bumping into macOS Sonoma","anchor":"Bumping-into-macOS-Sonoma","level":3},{"type":"paragraph","inlineContent":[{"type":"text","text":"I published my blog post on using snapshot tests with Xcode Cloud and everything"},{"type":"text","text":" "},{"text":"was working great with tests passing both locally and remotely. Since I have","type":"text"},{"text":" ","type":"text"},{"text":"been using snapshot tests for a while that was a bit surprising to me, but I’ll","type":"text"},{"type":"text","text":" "},{"type":"text","text":"touch on why that is a bit later. Days or weeks went by, I’d made changes that I"},{"type":"text","text":" "},{"text":"no longer remembered (or maybe the world changed around me), and my snapshot","type":"text"},{"type":"text","text":" "},{"text":"tests were no longer passing on Xcode Cloud. I was especially upset by this","type":"text"},{"text":" ","type":"text"},{"text":"because I’d recently shared that blog post about how to get things working and","type":"text"},{"type":"text","text":" "},{"type":"text","text":"felt guilty for spreading misinformation."}]},{"inlineContent":[{"text":"Once I got some time to look into the issue I realized that one of two things","type":"text"},{"text":" ","type":"text"},{"text":"had happened:","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"I had changed the Xcode Cloud environment to run on macOS Sonoma, or"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"The latest version of macOS Sonoma changed the behavior of the snapshots"}],"type":"paragraph"}]}],"type":"orderedList"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Basically, the issue had to do with running my snapshot tests on macOS Sonoma on"},{"type":"text","text":" "},{"text":"Xcode Cloud (running on Sonoma locally to record the snapshots seems fine) which","type":"text"},{"type":"text","text":" "},{"type":"text","text":"had just made it to the release candidate stage. Changing the Xcode Cloud"},{"text":" ","type":"text"},{"text":"environment back to macOS Ventura resolved the issue and I was able to move on","type":"text"},{"type":"text","text":" "},{"text":"knowing that I had not completely misled people.","type":"text"}]},{"level":3,"anchor":"Bumping-into-TabView","text":"Bumping into TabView","type":"heading"},{"type":"paragraph","inlineContent":[{"text":"Someone in the Point-Free Slack mentioned that the snapshots they generated of","type":"text"},{"type":"text","text":" "},{"type":"text","text":"their tab bar did not look correct. I hadn’t tried creating snapshots for the"},{"type":"text","text":" "},{"text":"tab bar in my app, so I hadn’t run into the issue before, but I was quickly able","type":"text"},{"type":"text","text":" "},{"text":"to reproduce. The snapshots looked like this (the unselected tab bar icons are","type":"text"},{"text":" ","type":"text"},{"text":"white which makes them very difficult to see):","type":"text"}]},{"inlineContent":[{"type":"image","identifier":"miscoloredTabBar"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"I found a workaround — by adding this code before my "},{"type":"codeVoice","code":"assertSnapshot"},{"text":" ","type":"text"},{"type":"text","text":"calls the tab bar would render correctly:"}]},{"type":"codeListing","syntax":"swift","code":["UITabBar.appearance().unselectedItemTintColor = .systemGray"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"This feels a bit hacky to me but it worked."}]},{"text":"Bumping into List","level":3,"anchor":"Bumping-into-List","type":"heading"},{"type":"paragraph","inlineContent":[{"type":"text","text":"The bumps are piling up but at least I can bandage them — I’ve found"},{"text":" ","type":"text"},{"text":"sometimes hacky, sometimes regressive, workarounds. As long as Apple always","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"supports macOS Ventura then I don’t need to worry about the issue with Sonoma,"},{"type":"text","text":" "},{"type":"text","text":"right?"}]},{"type":"paragraph","inlineContent":[{"text":"But throughout these fights I’d been ignoring a glaring issue with the snapshots","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"of the SwiftUI "},{"type":"codeVoice","code":"List"},{"text":" in my app. Take a look at this monstrosity:","type":"text"}]},{"type":"paragraph","inlineContent":[{"identifier":"misrenderedSwiftUIList","type":"image"}]},{"inlineContent":[{"text":"OK maybe calling it a monstrosity is harsh. And the contrast between the light","type":"text"},{"text":" ","type":"text"},{"text":"gray and the white is not great so the issue may be difficult to see, but each","type":"text"},{"type":"text","text":" "},{"text":"row in the ","type":"text"},{"code":"List","type":"codeVoice"},{"text":" has rounded corners instead of only the top leading, top","type":"text"},{"type":"text","text":" "},{"type":"text","text":"trailing on the first item and bottom leading and bottom trailing on the last"},{"type":"text","text":" "},{"text":"item having rounded corners. What is going on there?","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"I tried a lot of different things to try to get this to render properly."}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"I thought that perhaps it was a timing issue and the UI needed more time to"},{"text":" ","type":"text"},{"type":"text","text":"layout so I increased the wait time before capturing the snapshot. Nope."}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"I thought that maybe the wait time wasn’t enough and that I needed to increase"},{"type":"text","text":" "},{"type":"text","text":"the speed of the animations so I tried setting the "},{"type":"codeVoice","code":"window.layer.speed = 100"},{"type":"text","text":"."},{"type":"text","text":" "},{"type":"text","text":"Nope."}]},{"type":"paragraph","inlineContent":[{"text":"I found ","type":"text"},{"type":"reference","isActive":true,"identifier":"https:\/\/github.com\/pointfreeco\/swift-snapshot-testing\/issues\/667"},{"text":" ","type":"text"},{"type":"text","text":"on the snapshot testing library and I was first encouraged by"},{"type":"text","text":" "},{"isActive":true,"type":"reference","identifier":"https:\/\/github.com\/pointfreeco\/swift-snapshot-testing\/issues\/667#issuecomment-1462270406"},{"text":" ","type":"text"},{"type":"text","text":"and then disappointed when "},{"type":"reference","isActive":true,"identifier":"https:\/\/github.com\/pointfreeco\/swift-snapshot-testing\/issues\/667#issuecomment-1463810906"},{"text":".","type":"text"}]},{"type":"paragraph","inlineContent":[{"text":"I was out of options. I tried it anyway. And it worked! 🎉","type":"text"}]},{"anchor":"Why-Did-I-Keep-Bumping-into-Things","type":"heading","level":2,"text":"Why Did I Keep Bumping into Things?"},{"type":"paragraph","inlineContent":[{"text":"I’ve said before, and I’ll say it again now: Point-Free’s snapshot testing","type":"text"},{"type":"text","text":" "},{"type":"text","text":"library is great. So why am I running into so many issues? Why is this so"},{"text":" ","type":"text"},{"text":"painful? I think those three pain points are instructive so let’s talk through","type":"text"},{"type":"text","text":" "},{"type":"text","text":"the root causes of each of those."}]},{"text":"macOS Sonoma Rendering Differently on Xcode Cloud’s Intel machines","level":3,"anchor":"macOS-Sonoma-Rendering-Differently-on-Xcode-Clouds-Intel-machines","type":"heading"},{"style":"note","content":[{"inlineContent":[{"text":"Since writing this blog post I’ve solved the problem","type":"text"},{"type":"text","text":" "},{"type":"text","text":"with simulators on Sonoma and wrote about it in "},{"overridingTitle":"a new blog post about controlling simulators on Xcode Cloud","identifier":"doc:\/\/Brunow\/documentation\/Brunow\/11-30-follow-up-snapshot-testing-xcode-cloud-sonoma","type":"reference","isActive":true,"overridingTitleInlineContent":[{"type":"text","text":"a new blog post about controlling simulators on Xcode Cloud"}]},{"type":"text","text":"."}],"type":"paragraph"}],"type":"aside","name":"Note from the future"},{"type":"paragraph","inlineContent":[{"type":"strikethrough","inlineContent":[{"type":"text","text":"I have absolutely no insight into why I’m seeing the behavior I’m seeing on"},{"type":"text","text":" "},{"type":"text","text":"Xcode Cloud but I can make some guesses based upon what I do know. I know that"},{"text":" ","type":"text"},{"type":"text","text":"Apple is going through a processor transition where their CPUs have changed from"},{"text":" ","type":"text"},{"type":"text","text":"being manufactured by Intel to being manufactured by Apple. Along with this CPU"},{"type":"text","text":" "},{"type":"text","text":"change comes GPU changes as well since Apple is creating their own GPUs."}]}]},{"type":"paragraph","inlineContent":[{"type":"strikethrough","inlineContent":[{"type":"text","text":"Again, I don’t know the details, but this foundational change is somehow leaking"},{"type":"text","text":" "},{"text":"into our snapshot testing when running macOS Sonoma. I think the only people","type":"text"},{"type":"text","text":" "},{"text":"that can fix this work at Apple so I filed FB_INSERT_FEEDBACK_HERE.","type":"text"}]}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"That struck out code was my first attempt at explaining the behavior just a"},{"type":"text","text":" "},{"text":"week or two ago while first drafting this post — I’m sharing it here to give","type":"text"},{"type":"text","text":" "},{"text":"a little insight into the circuitous path I took to get to an understanding of","type":"text"},{"type":"text","text":" "},{"type":"text","text":"these issues. Since then"},{"type":"text","text":" "},{"identifier":"#Using-strong-opinions-in-higher-level-libraries","isActive":true,"type":"reference"},{"type":"text","text":"."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"So could that be the reason why the rendering is different on macOS Sonoma?"},{"type":"text","text":" "},{"text":"Let’s cook up a test failure to see by adding this to our snapshotting code:","type":"text"}]},{"code":["if Locale.preferredLanguages.contains(where: {","  $0.contains(\"ar\") || $0.contains(\"hy\")","}) {","  XCTFail(","    \"\"\"","    Running on a simulator with Arabic or Armenian in its preferred","    languages which will cause the snapshots to be rendered differently.","    Please remove Arabic and\/or Armenian from the simulator's preferred","    languages (Settings > General > Language & Region).","    \"\"\",","    file: file,","    line: line","  )","  return","}"],"type":"codeListing","syntax":"swift"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Then we’ll run the tests again on Xcode Cloud on a macOS Sonoma machine:"}]},{"inlineContent":[{"type":"image","identifier":"arabicOrArmenianTestFailure"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Well there we go. That same test passes on macOS Ventura. But that leads me to"},{"type":"text","text":" "},{"text":"wonder “how many different preferred languages are setup in the Sonoma","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"simulator?”"}]},{"type":"paragraph","inlineContent":[{"identifier":"numberOfPreferredLanguagesXcodeCloudSonoma","type":"image"}]},{"inlineContent":[{"text":"OK 34 preferred languages, cool. Running this same test on macOS Ventura returns","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"1 preferred language. Now I’m a bit more curious – which languages did they"},{"text":" ","type":"text"},{"type":"text","text":"choose? Here they are as of October 2023 (notice that Arabic is in this list –"},{"type":"text","text":" "},{"type":"text","text":"I talk about why that is noteworthy in a later section that I linked above):"}],"type":"paragraph"},{"header":"row","rows":[[[{"inlineContent":[],"type":"paragraph"}],[{"inlineContent":[],"type":"paragraph"}],[{"inlineContent":[],"type":"paragraph"}],[{"type":"paragraph","inlineContent":[]}],[{"inlineContent":[],"type":"paragraph"}],[{"inlineContent":[],"type":"paragraph"}],[{"inlineContent":[],"type":"paragraph"}]],[[{"type":"paragraph","inlineContent":[{"type":"text","text":"en"}]}],[{"inlineContent":[{"text":"ja","type":"text"}],"type":"paragraph"}],[{"type":"paragraph","inlineContent":[{"text":"sv","type":"text"}]}],[{"type":"paragraph","inlineContent":[{"text":"el","type":"text"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"pt-BR"}]}],[{"type":"paragraph","inlineContent":[{"text":"th","type":"text"}]}],[{"inlineContent":[{"type":"text","text":"id"}],"type":"paragraph"}]],[[{"inlineContent":[{"type":"text","text":"fr"}],"type":"paragraph"}],[{"type":"paragraph","inlineContent":[{"text":"es","type":"text"}]}],[{"type":"paragraph","inlineContent":[{"text":"ru","type":"text"}]}],[{"inlineContent":[{"type":"text","text":"he"}],"type":"paragraph"}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"pt-PT"}]}],[{"type":"paragraph","inlineContent":[{"text":"cs","type":"text"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"ms"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"text","text":"de"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"it"}]}],[{"inlineContent":[{"type":"text","text":"pl"}],"type":"paragraph"}],[{"inlineContent":[{"type":"text","text":"ro"}],"type":"paragraph"}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"da"}]}],[{"type":"paragraph","inlineContent":[{"text":"hu","type":"text"}]}],[{"inlineContent":[{"type":"text","text":"vi"}],"type":"paragraph"}]],[[{"type":"paragraph","inlineContent":[{"type":"text","text":"zh-Hans"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"nl"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"tr"}]}],[{"type":"paragraph","inlineContent":[{"text":"sk","type":"text"}]}],[{"type":"paragraph","inlineContent":[{"text":"fi","type":"text"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"ca"}]}],[{"type":"paragraph","inlineContent":[{"text":"es-419","type":"text"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"text","text":"zh-Hant"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"ko"}]}],[{"inlineContent":[{"text":"ar","type":"text"}],"type":"paragraph"}],[{"type":"paragraph","inlineContent":[{"text":"uk","type":"text"}]}],[{"type":"paragraph","inlineContent":[{"text":"nb","type":"text"}]}],[{"inlineContent":[{"text":"hr","type":"text"}],"type":"paragraph"}],[{"inlineContent":[],"type":"paragraph"}]]],"type":"table"},{"type":"paragraph","inlineContent":[{"type":"text","text":"OK so it is great that the simulators include languages other than English –"},{"text":" ","type":"text"},{"text":"app development is not something that only happens in the English speaking","type":"text"},{"type":"text","text":" "},{"text":"world – but this does add more complexity to our snapshot testing story. I’ve","type":"text"},{"type":"text","text":" "},{"type":"text","text":"created "},{"identifier":"https:\/\/github.com\/feedback-assistant\/reports\/issues\/431","type":"reference","isActive":true},{"type":"text","text":" to ask for control over"},{"type":"text","text":" "},{"type":"text","text":"the preferred languages in Xcode Cloud. Until we get that we may have to make"},{"text":" ","type":"text"},{"type":"text","text":"our local simulators mirror what is setup on Xcode Cloud."}]},{"level":3,"text":"TabView misrendering","anchor":"TabView-misrendering","type":"heading"},{"type":"paragraph","inlineContent":[{"text":"Let’s take a look at","type":"text"},{"type":"text","text":" "},{"identifier":"https:\/\/github.com\/pointfreeco\/swift-snapshot-testing\/blob\/main\/Sources\/SnapshotTesting\/Snapshotting\/UIViewController.swift#L48","type":"reference","isActive":true},{"type":"text","text":":"}]},{"type":"codeListing","syntax":"swift","code":["\/\/\/   - drawHierarchyInKeyWindow: Utilize the simulator's key window in order to render","\/\/\/     `UIAppearance` and `UIVisualEffect`s. This option requires a host application for your","\/\/\/     tests and will _not_ work for framework test targets."]},{"inlineContent":[{"type":"text","text":"This is the documentation for a strategy that we have not been using and"},{"type":"text","text":" "},{"text":"therefore we are not getting this behavior. That part about the ","type":"text"},{"type":"codeVoice","code":"UIAppearance"},{"type":"text","text":" "},{"type":"text","text":"might be the answer to our question about why the tab bar is not being rendered"},{"type":"text","text":" "},{"text":"correctly. Perhaps those unselected tab colors are being set on the","type":"text"},{"type":"text","text":" "},{"type":"codeVoice","code":"UIAppearance"},{"type":"text","text":"."}],"type":"paragraph"},{"name":"Aside","style":"note","content":[{"inlineContent":[{"type":"text","text":"Surprisingly the Snapshot Testing libraries documentation around the"},{"text":" ","type":"text"},{"text":"differences between the view controller snapshotting strategies is lacking a","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"larger discussion about when to choose which. I’ve opened "},{"type":"reference","identifier":"https:\/\/github.com\/pointfreeco\/swift-snapshot-testing\/pull\/796","isActive":true},{"text":".","type":"text"}],"type":"paragraph"}],"type":"aside"},{"type":"paragraph","inlineContent":[{"type":"text","text":"So I have a theory about what is going on but I think we need to dig in on what"},{"type":"text","text":" "},{"type":"text","text":"this "},{"code":"drawHierarchyInKeyWindow","type":"codeVoice"},{"type":"text","text":" parameter does. Let’s do that while looking at"},{"type":"text","text":" "},{"text":"the rendering issues with ","type":"text"},{"code":"List","type":"codeVoice"},{"type":"text","text":"."}]},{"text":"List misrendering","anchor":"List-misrendering","type":"heading","level":3},{"type":"paragraph","inlineContent":[{"type":"text","text":"To try to understand what might be going on with the "},{"code":"List","type":"codeVoice"},{"type":"text","text":" I think we need"},{"type":"text","text":" "},{"type":"text","text":"to talk through how the snapshot images are created. To do so we can dig through"},{"type":"text","text":" "},{"text":"the code (yay open source!) and find ","type":"text"},{"identifier":"https:\/\/github.com\/pointfreeco\/swift-snapshot-testing\/blob\/main\/Sources\/SnapshotTesting\/Common\/View.swift#L990C46-L990C46","isActive":true,"type":"reference"},{"text":":","type":"text"}]},{"syntax":"swift","code":["...","  if drawHierarchyInKeyWindow {","    view.drawHierarchy(in: view.bounds, afterScreenUpdates: true)","  } else {","    view.layer.render(in: ctx.cgContext)","  }","..."],"type":"codeListing"},{"type":"aside","content":[{"type":"paragraph","inlineContent":[{"text":"It would be nice if this code block had line numbers so I could refer to them","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"to improve communication. I created an"},{"type":"text","text":" "},{"isActive":true,"identifier":"https:\/\/github.com\/apple\/swift-docc\/issues\/737","type":"reference"},{"type":"text","text":""},{"type":"text","text":" "},{"type":"text","text":"for that."}]}],"style":"note","name":"Aside"},{"inlineContent":[{"text":"Depending on the value of ","type":"text"},{"type":"codeVoice","code":"drawHierarchyInKeyWindow"},{"type":"text","text":" either the"},{"text":" ","type":"text"},{"isActive":true,"type":"reference","identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uiview\/1622589-drawhierarchy"},{"type":"text","text":" "},{"text":"or the ","type":"text"},{"type":"reference","identifier":"https:\/\/developer.apple.com\/documentation\/quartzcore\/calayer\/1410909-render","isActive":true},{"type":"text","text":" method is called."},{"type":"text","text":" "},{"type":"text","text":"Both of these are methods provided by Apple that have been in the SDK for a long"},{"text":" ","type":"text"},{"type":"text","text":"time. We can look up their documentation (linked in the method names) but what"},{"type":"text","text":" "},{"text":"we find isn’t super useful, at least not to me. Here is a snippet from the","type":"text"},{"type":"text","text":" "},{"type":"codeVoice","code":"drawHierarchy"},{"type":"text","text":" documentation:"}],"type":"paragraph"},{"content":[{"inlineContent":[{"text":"Renders a snapshot of the complete view hierarchy as visible onscreen","type":"text"},{"type":"text","text":" "},{"type":"text","text":"into the current context."}],"type":"paragraph"}],"style":"note","type":"aside","name":"Quote"},{"type":"paragraph","inlineContent":[{"type":"text","text":"OK that sounds great, that’s exactly what we want. So why do we need the"},{"type":"text","text":" "},{"type":"codeVoice","code":"render"},{"text":" method? Maybe its documentation gives us a clue:","type":"text"}]},{"style":"note","name":"Quote","type":"aside","content":[{"inlineContent":[{"text":"Renders the layer and its sublayers into the specified context.","type":"text"}],"type":"paragraph"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"OK so the difference is that "},{"code":"render","type":"codeVoice"},{"text":" only renders a layer and ","type":"text"},{"type":"codeVoice","code":"drawHierarchy"},{"text":" ","type":"text"},{"text":"renders the complete view hierarchy. But to do that you need a complete view","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"hierarchy which we see on "},{"isActive":true,"type":"reference","identifier":"https:\/\/github.com\/pointfreeco\/swift-snapshot-testing\/blob\/main\/Sources\/SnapshotTesting\/Common\/View.swift#L940C36-L940C36"},{"type":"text","text":":"}]},{"syntax":"swift","type":"codeListing","code":["...","if drawHierarchyInKeyWindow {","  guard let keyWindow = getKeyWindow() else {","    fatalError(\"'drawHierarchyInKeyWindow' requires tests to be run in a host application\")","  }","..."]},{"inlineContent":[{"type":"text","text":"To draw the complete view hierarchy in the key window we need something called a"},{"text":" ","type":"text"},{"type":"text","text":"key window and we can only get that with something called a host application."}],"type":"paragraph"},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Technically we only need to be running in a host application to be able to"},{"text":" ","type":"text"},{"type":"text","text":"draw the complete view hierarchy using "},{"code":"drawHierarchy","type":"codeVoice"},{"text":" but the snapshot","type":"text"},{"type":"text","text":" "},{"type":"text","text":"testing library does not support using that method without also using the key"},{"text":" ","type":"text"},{"text":"window.","type":"text"}]}],"style":"note","name":"Note","type":"aside"},{"inlineContent":[{"type":"text","text":"The "},{"identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uiapplication\/1622924-keywindow","type":"reference","isActive":true},{"type":"text","text":" "},{"text":"is the application window with which the user is interacting. That property I","type":"text"},{"type":"text","text":" "},{"text":"linked to on ","type":"text"},{"code":"UIApplication","type":"codeVoice"},{"type":"text","text":" is deprecated since Apple no longer wants us to"},{"text":" ","type":"text"},{"text":"think about an application having a single window and instead to think in terms","type":"text"},{"text":" ","type":"text"},{"text":"of a multi-window world, but that deprecation doesn’t matter for our purposes","type":"text"},{"type":"text","text":" "},{"type":"text","text":"since the concept of a key window is still valid."}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"A host application is an application within which we can run our tests. This"},{"type":"text","text":" "},{"text":"gets a bit complex in the current Apple ecosystem when you choose to use Swift","type":"text"},{"type":"text","text":" "},{"text":"Package Manager to modularize your dependencies like I did in the last blog","type":"text"},{"type":"text","text":" "},{"type":"text","text":"post. Swift packages have no concept of a host application and therefore tests"},{"type":"text","text":" "},{"text":"in Swift packages cannot be run inside a host application. Since I’m building an","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"iOS app I have a host application at my disposal which I can use and I’ll talk"},{"text":" ","type":"text"},{"type":"text","text":"about how to do that a bit later. For now, let’s get back to these two different"},{"type":"text","text":" "},{"type":"text","text":"methods for creating snapshots of our user interface."}],"type":"paragraph"},{"style":"note","type":"aside","content":[{"type":"paragraph","inlineContent":[{"text":"The host application story for Swift packages could be improved and I’m","type":"text"},{"type":"text","text":" "},{"text":"not the first to notice that —","type":"text"},{"type":"text","text":" "},{"isActive":true,"type":"reference","identifier":"https:\/\/forums.swift.org\/t\/host-application-for-spm-tests\/24363"},{"type":"text","text":" "},{"text":"was started in 2019. While I like to take action to try to improve the little","type":"text"},{"type":"text","text":" "},{"type":"text","text":"parts of the world that I can, I’m not sure what action to take here."}]}],"name":"Aside"},{"type":"paragraph","inlineContent":[{"type":"text","text":"What we’ve seen so far is two conditionals with two branches each and therefore"},{"text":" ","type":"text"},{"text":"4 different ways that snapshots could theoretically be captured (based upon the","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"conditional’s logic only 3 of these possibilities can actually be used in the"},{"type":"text","text":" "},{"type":"text","text":"snapshot testing library but I think it is useful to think through them all):"}]},{"type":"table","header":"row","rows":[[[{"inlineContent":[{"type":"text","text":"Method"}],"type":"paragraph"}],[{"type":"paragraph","inlineContent":[{"text":"Window","type":"text"}]}],[{"inlineContent":[{"type":"text","text":"Configurable without code changes"}],"type":"paragraph"}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"drawHierarchy"}]}],[{"inlineContent":[{"code":"UIWindow()","type":"codeVoice"}],"type":"paragraph"}],[{"inlineContent":[{"type":"text","text":"No"}],"type":"paragraph"}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"drawHierarchy"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"Key window"}]}],[{"inlineContent":[{"type":"text","text":"Yes"}],"type":"paragraph"}]],[[{"type":"paragraph","inlineContent":[{"code":"render","type":"codeVoice"}]}],[{"inlineContent":[{"type":"codeVoice","code":"UIWindow()"}],"type":"paragraph"}],[{"type":"paragraph","inlineContent":[{"text":"Yes","type":"text"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"render"}]}],[{"type":"paragraph","inlineContent":[{"text":"Key window","type":"text"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"Yes"}]}]]]},{"inlineContent":[{"text":"Then my followup question to that table is “do any of these configurations fix","type":"text"},{"text":" ","type":"text"},{"text":"the bad behavior I’m seeing with my ","type":"text"},{"type":"codeVoice","code":"List"},{"type":"text","text":"?” (I had to modify the snapshot"},{"text":" ","type":"text"},{"type":"text","text":"testing code to test the first “impossible” configuration):"}],"type":"paragraph"},{"type":"table","header":"row","rows":[[[{"type":"paragraph","inlineContent":[{"text":"Method","type":"text"}]}],[{"inlineContent":[{"text":"Window","type":"text"}],"type":"paragraph"}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"Fixes "},{"code":"List","type":"codeVoice"}]}]],[[{"inlineContent":[{"type":"codeVoice","code":"drawHierarchy"}],"type":"paragraph"}],[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"UIWindow()"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"Yes*"}]}]],[[{"inlineContent":[{"code":"drawHierarchy","type":"codeVoice"}],"type":"paragraph"}],[{"inlineContent":[{"type":"text","text":"Key window"}],"type":"paragraph"}],[{"inlineContent":[{"type":"text","text":"Yes"}],"type":"paragraph"}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"render"}]}],[{"inlineContent":[{"type":"codeVoice","code":"UIWindow()"}],"type":"paragraph"}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"No"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"render"}]}],[{"inlineContent":[{"text":"Key window","type":"text"}],"type":"paragraph"}],[{"type":"paragraph","inlineContent":[{"text":"No","type":"text"}]}]]]},{"style":"note","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"I added the asterisk on the first line because while the "},{"code":"List","type":"codeVoice"},{"text":" ","type":"text"},{"type":"text","text":"was rendered properly the tab bar’s tabs were not properly positioned as you"},{"type":"text","text":" "},{"type":"text","text":"can see in this diff where the tab bar is positioned too low in the view:"},{"type":"text","text":" "},{"type":"image","identifier":"diffBetweenDrawHierarchyKeyWindowUIWindow"}]}],"name":"Note","type":"aside"},{"inlineContent":[{"type":"text","text":"So the main difference in our "},{"type":"codeVoice","code":"List"},{"type":"text","text":" rendering is the method being called."},{"text":" ","type":"text"},{"text":"We’ve already looked at the Apple documentation and I didn’t see any clues there","type":"text"},{"text":" ","type":"text"},{"text":"as to the underlying reason behind the differences in behavior — that","type":"text"},{"type":"text","text":" "},{"text":"documentation did not even mention the difference in ","type":"text"},{"code":"UIAppearance","type":"codeVoice"},{"type":"text","text":" mentioned"},{"text":" ","type":"text"},{"text":"by the snapshot testing documentation.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"text":"After some internet searching I found","type":"text"},{"text":" ","type":"text"},{"type":"reference","identifier":"https:\/\/stackoverflow.com\/a\/25704861","isActive":true},{"type":"text","text":" that"},{"type":"text","text":" "},{"text":"talks about the implementation differences between those two methods:","type":"text"}],"type":"paragraph"},{"name":"Quote about drawHierarchy method","content":[{"inlineContent":[{"type":"text","text":"The method "},{"type":"codeVoice","code":"drawViewHierarchyInRect:afterScreenUpdates:"},{"type":"text","text":" performs its"},{"text":" ","type":"text"},{"text":"operations on the GPU as much as possible, and much of this work will probably","type":"text"},{"type":"text","text":" "},{"type":"text","text":"happen outside of your app’s address space in another process. Passing YES as"},{"type":"text","text":" "},{"type":"text","text":"the afterScreenUpdates: parameter to "},{"code":"drawViewHierarchyInRect:afterScreenUpdates:","type":"codeVoice"},{"type":"text","text":" "},{"text":"will cause a Core Animation to flush all of its buffers in your task and in","type":"text"},{"text":" ","type":"text"},{"text":"the rendering task. As you may imagine, there’s a lot of other internal stuff","type":"text"},{"type":"text","text":" "},{"type":"text","text":"that goes on in these cases too."}],"type":"paragraph"}],"type":"aside","style":"note"},{"type":"aside","name":"Quote about render method","content":[{"type":"paragraph","inlineContent":[{"text":"In comparison, the method ","type":"text"},{"code":"renderInContext:","type":"codeVoice"},{"type":"text","text":" performs"},{"type":"text","text":" "},{"text":"its operations inside of your app’s address space and does not use the GPU","type":"text"},{"type":"text","text":" "},{"text":"based process for performing the work…This route is not as efficient as it","type":"text"},{"text":" ","type":"text"},{"text":"does not use the GPU based task. Also, it is not as accurate for screen","type":"text"},{"text":" ","type":"text"},{"text":"captures as it may exclude blurs and other Core Animation features that are","type":"text"},{"type":"text","text":" "},{"type":"text","text":"managed by the GPU task."}]}],"style":"note"},{"type":"paragraph","inlineContent":[{"text":"So the ","type":"text"},{"type":"codeVoice","code":"render(in:)"},{"type":"text","text":" method is both less efficient and creates less accurate"},{"text":" ","type":"text"},{"text":"results!?! 😲 Why would we want to consider it as an option?","type":"text"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Well, as we noted before, the "},{"type":"codeVoice","code":"drawHierarchy"},{"type":"text","text":" method only works when the tests"},{"text":" ","type":"text"},{"text":"are hosted in an application. And as I mentioned before, at this point in time","type":"text"},{"text":" ","type":"text"},{"text":"there is no way for a Swift package’s tests to be hosted in an application","type":"text"},{"type":"text","text":" "},{"type":"text","text":"without a separate Xcode project. The "},{"type":"codeVoice","code":"render(in:)"},{"type":"text","text":" method is the only choice to"},{"type":"text","text":" "},{"text":"use image based snapshot tests in a Swift package. Running tests inside of a","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"host application is also much slower than running them standalone and folks"},{"text":" ","type":"text"},{"text":"might want to make that tradeoff of accuracy for test speed.","type":"text"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"I’ve created a ","type":"text"},{"identifier":"https:\/\/github.com\/pointfreeco\/swift-snapshot-testing\/discussions\/797","type":"reference","isActive":true},{"text":" around whether","type":"text"},{"type":"text","text":" "},{"code":"drawViewHierarchy","type":"codeVoice"},{"type":"text","text":" should be the default codepath if the tests are being run"},{"text":" ","type":"text"},{"text":"inside a host application.","type":"text"}]}],"type":"aside","style":"note","name":"Aside"},{"type":"paragraph","inlineContent":[{"type":"text","text":"I think it is also worth noting that neither of these API were created with the"},{"text":" ","type":"text"},{"text":"intent of supporting snapshot testing. Without intentional support of that use","type":"text"},{"type":"text","text":" "},{"type":"text","text":"case we can’t expect the Apple folks working on those API and supporting them"},{"type":"text","text":" "},{"type":"text","text":"across OS versions, processor architectures, and everything else changing to"},{"text":" ","type":"text"},{"type":"text","text":"ensure that they work for this purpose. That being said, I believe that Apple"},{"text":" ","type":"text"},{"text":"should consider snapshot testing to be a first-class use case for these API (or","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"to provide separate API for that purpose) and therefore I’ve filed"},{"text":" ","type":"text"},{"type":"reference","identifier":"https:\/\/github.com\/feedback-assistant\/reports\/issues\/430","isActive":true},{"type":"text","text":" for that."}]},{"type":"heading","level":2,"anchor":"Rough-edges-in-low-level-general-libraries","text":"Rough edges in low-level, general libraries"},{"type":"paragraph","inlineContent":[{"text":"As I’ve mentioned before I think the Swift Snapshot Testing library is very","type":"text"},{"type":"text","text":" "},{"text":"good. But I’ve also typed a fair number of words and spent a large amount of","type":"text"},{"type":"text","text":" "},{"type":"text","text":"time working around these rough edges on the API. How can I think it is a good"},{"text":" ","type":"text"},{"text":"library and think it has rough edges? Do I have a poor sense of quality?","type":"text"}]},{"type":"paragraph","inlineContent":[{"text":"I may have a poor sense of quality elsewhere (I did once watch an entire movie","type":"text"},{"type":"text","text":" "},{"text":"about a homicidal tire named Robert) but I don’t think that is the case here.","type":"text"},{"type":"text","text":" "},{"text":"These rough edges come from two things: 1) the library authors are building upon","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"lower level things that have rough edges, and 2) the library is low-level and"},{"text":" ","type":"text"},{"type":"text","text":"general purpose."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"The only way to cover over rough edges in the things that you are building on"},{"type":"text","text":" "},{"type":"text","text":"top of is to make decisions for the end users of the library. But making those"},{"type":"text","text":" "},{"type":"text","text":"decisions for the end users takes away the end users’ power and flexibility."},{"type":"text","text":" "},{"type":"text","text":"Like most engineering, this is a trade-off and I think the authors of this"},{"text":" ","type":"text"},{"type":"text","text":"library made the right choice. My only minor gripe would be that, as I mentioned"},{"text":" ","type":"text"},{"type":"text","text":"before, the documentation around these trade-offs is lacking and therefore I, as"},{"type":"text","text":" "},{"text":"an end user of this library, am not able to make as informed of a decision as I","type":"text"},{"type":"text","text":" "},{"type":"text","text":"would like."}]},{"type":"heading","text":"Using strong opinions in higher level libraries","level":2,"anchor":"Using-strong-opinions-in-higher-level-libraries"},{"inlineContent":[{"type":"text","text":"If I know my end users (or if I’m my own end user) then I can make informed"},{"text":" ","type":"text"},{"text":"decisions for them which will cover over most of the rough edges from the lower","type":"text"},{"type":"text","text":" "},{"text":"levels without taking away the power they need. There will be exceptions, like","type":"text"},{"text":" ","type":"text"},{"text":"the rendering differences in macOS Sonoma on Xcode Cloud, but the experience can","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"be much simpler. The trade-off here is that I need to ensure the environment the"},{"type":"text","text":" "},{"text":"end user is working in matches the expectations of my strong opinions — they","type":"text"},{"type":"text","text":" "},{"type":"text","text":"need to have their tests setup the proper way and have them hosted inside an"},{"type":"text","text":" "},{"type":"text","text":"application."}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"text":"But even my strongest opinions can’t cover over all the issues and it is in","type":"text"},{"text":" ","type":"text"},{"text":"those cases that we need to provide other ergonomics. For example, if you","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"capture your golden snapshot on a simulator that renders at a display scale of"},{"text":" ","type":"text"},{"type":"codeVoice","code":"@3x"},{"type":"text","text":" and then run a follow-up test on a simulator that renders at a display"},{"text":" ","type":"text"},{"type":"text","text":"scale of "},{"code":"@2x","type":"codeVoice"},{"type":"text","text":" the test will fail. Similar failures will happen with different"},{"type":"text","text":" "},{"text":"iOS versions due to minor differences in text layout, and with different","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"simulators based upon the size of their status bar. In those cases we can find"},{"type":"text","text":" "},{"text":"way to gently nudge the user onto the right path.","type":"text"}]},{"inlineContent":[{"type":"text","text":"Even this approach has some flaws. After I finished that paragraph I went to"},{"type":"text","text":" "},{"text":"test out a change to see if I could make my library more ergonomic when a","type":"text"},{"text":" ","type":"text"},{"text":"simulator was set to a different language and found that all my tests were","type":"text"},{"type":"text","text":" "},{"text":"failing. Apparently if Arabic is in the list of languages — even if it isn’t","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"the default language — the simulator will render differently. Now that I’ve"},{"type":"text","text":" "},{"type":"text","text":"figured that out I can add a check for that to the library but I can never be"},{"type":"text","text":" "},{"text":"sure that I’ve covered every rough edge.","type":"text"}],"type":"paragraph"},{"style":"note","name":"Note","content":[{"inlineContent":[{"type":"text","text":"I went down a long path to try to create an example project that would show"},{"type":"text","text":" "},{"text":"the issue of the simulator rendering differently when Arabic is in the list of","type":"text"},{"type":"text","text":" "},{"type":"text","text":"preferred languages. Some ways down that path I asked myself “does this"},{"type":"text","text":" "},{"text":"happen on device as well?” and, ","type":"text"},{"inlineContent":[{"type":"text","text":"turns out"}],"type":"emphasis"},{"text":", the answer is yes. I was going to","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"file a Feedback about this but I think the behavior, while unexpected to me,"},{"type":"text","text":" "},{"type":"text","text":"is correct. If an app knows that a user prefers Arabic then they might need to"},{"type":"text","text":" "},{"text":"show Arabic text in their app and therefore they need the SF Arabic font and","type":"text"},{"type":"text","text":" "},{"type":"text","text":"the extra vertical height it has."}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"text":"This led me to think “which other languages might behave similarly?” I have","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"not tested every language to find out but I did identify another language that"},{"type":"text","text":" "},{"type":"text","text":"changes the rendering like Arabic does. I started on this"},{"type":"text","text":" "},{"type":"reference","identifier":"https:\/\/developer.apple.com\/fonts\/","isActive":true},{"type":"text","text":" which"},{"text":" ","type":"text"},{"text":"describes a category of SF Script Extensions into which SF Arabic falls. I","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"tested the other script extensions and found that Armenian behaves similarly"},{"text":" ","type":"text"},{"type":"text","text":"to Arabic."}]}],"type":"aside"},{"anchor":"My-opinions","level":2,"text":"My opinions","type":"heading"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"All snapshot tests should be hosted."}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"All snapshot tests should use ","type":"text"},{"type":"codeVoice","code":"drawHierarchyInKeyWindow = true"},{"type":"text","text":"."}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Snapshots should usually be generated on the latest device\/OS combination.","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Snapshots should fail early, with a helpful failure method, when the snapshot","type":"text"},{"type":"text","text":" "},{"text":"environment is different than we expect.","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Every view should be snapshotted in the same set of standard environments."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Users should have the option to create a “throwaway” snapshot for situations"},{"text":" ","type":"text"},{"text":"where dependencies or caches need to be setup to capture the right data.","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Snapshots should be rendered on a small device size to be able to find"},{"text":" ","type":"text"},{"type":"text","text":"layout issues at that size."}]}]}],"type":"unorderedList"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Next let’s talk about how to setup the environment for these opinions and the"},{"text":" ","type":"text"},{"type":"text","text":"helper code I’ve created to work with them."}]},{"anchor":"Setting-up-hosted-tests","type":"heading","text":"Setting up hosted tests","level":3},{"inlineContent":[{"type":"text","text":"Hosted tests need to live inside an app’s XCProject or XCWorkspace and need"},{"type":"text","text":" "},{"type":"text","text":"their own target. Here are the steps to set up the hosted tests:"}],"type":"paragraph"},{"type":"orderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Create a “Unit Testing Bundle” target. This could be named “SnapshotTests” if"},{"text":" ","type":"text"},{"type":"text","text":"you want to limit the scope of the kinds of tests that will be in this target or"},{"type":"text","text":" "},{"type":"text","text":"you could name it “Hosted Tests” since there might be other tests you want to"},{"text":" ","type":"text"},{"type":"text","text":"write in the future that won’t be snapshot tests but will need to be hosted. One"},{"type":"text","text":" "},{"text":"example would be live implementation tests for code that interacts with the","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"keychain. Make sure that your app is selected as the “Target to be Tested”"},{"text":" ","type":"text"},{"text":"because this is what makes the tests hosted.","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"If you have existing snapshot tests in your Swift package, copy them into the","type":"text"},{"text":" ","type":"text"},{"text":"folder created for the new test target. If you don’t have existing snapshot","type":"text"},{"type":"text","text":" "},{"type":"text","text":"tests then create the tests in that folder."}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Add the Swift Snapshot Testing dependency to the app project. Ensure that it"},{"text":" ","type":"text"},{"text":"is only added to the test target and not to the app target.","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"If using TCA, ensure that the app’s logic is not being run at the same time","type":"text"},{"type":"text","text":" "},{"text":"as the snapshot tests by wrapping the code that creates the store with","type":"text"},{"text":" ","type":"text"},{"code":"if _XCIsTesting == false { }","type":"codeVoice"},{"type":"text","text":"."}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Add the tests in the test target to the test plan."}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"If you’re using Xcode Cloud for CI, update the"},{"type":"text","text":" "},{"identifier":"doc:\/\/Brunow\/documentation\/Brunow\/08-30-snapshot-testing-with-xcode-cloud#Create-a-symlink-in-the-ciscripts-directory-to-where-our-snapshots-are-stored","isActive":true,"overridingTitle":"symlink in the ci_scripts folder","overridingTitleInlineContent":[{"text":"symlink in the ","type":"text"},{"type":"codeVoice","code":"ci_scripts"},{"type":"text","text":" folder"}],"type":"reference"},{"text":" to point to the new location for","type":"text"},{"text":" ","type":"text"},{"text":"snapshots.","type":"text"}],"type":"paragraph"}]}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Now that we have setup hosted tests we have no excuse for not using"},{"type":"text","text":" "},{"type":"text","text":"accessibility snapshot tests. Unfortunately adding them is a little more"},{"text":" ","type":"text"},{"type":"text","text":"complicated than simply importing the"},{"type":"text","text":" "},{"type":"reference","identifier":"https:\/\/github.com\/cashapp\/AccessibilitySnapshot","isActive":true},{"type":"text","text":" because nothing in"},{"type":"text","text":" "},{"type":"text","text":"technology is easy."}]},{"type":"heading","anchor":"While-were-at-it-lets-setup-accessibility-snapshot-tests","text":"While we’re at it, let’s setup accessibility snapshot tests","level":3},{"inlineContent":[{"type":"text","text":"Before we get into setting up the accessibility snapshot tests let me give you a"},{"type":"text","text":" "},{"text":"quick sales pitch for them. Accessibility snapshot tests give anyone who uses","type":"text"},{"type":"text","text":" "},{"text":"them a superpower. That superpower is to be able to look at a user interface and","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"know how a VoiceOver user would experience that user interface. Here’s an"},{"text":" ","type":"text"},{"type":"text","text":"example:"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"identifier":"accessibilitySnapshotTestExample","type":"image"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"This snapshot isn’t perfect – the order of the items in the navigation bar is"},{"text":" ","type":"text"},{"type":"text","text":"incorrect, they should be announced before the list rather than after (I created"},{"type":"text","text":" "},{"type":"reference","identifier":"https:\/\/github.com\/cashapp\/AccessibilitySnapshot\/issues\/168","isActive":true},{"type":"text","text":" for"},{"text":" ","type":"text"},{"text":"this). But even with that flaw this is fantastic – I can easily see that the","type":"text"},{"type":"text","text":" "},{"text":"order of the elements inside each row doesn’t make sense. The name and quantity","type":"text"},{"text":" ","type":"text"},{"text":"should be grouped together because that is related information that shouldn’t be","type":"text"},{"text":" ","type":"text"},{"text":"interrupted by the edit button. The alternative to these accessibility snapshot","type":"text"},{"type":"text","text":" "},{"type":"text","text":"tests is either firing up Accessibility Inspector or building to device with"},{"type":"text","text":" "},{"type":"text","text":"VoiceOver on and manually stepping through each element. And as a reviewer on a"},{"text":" ","type":"text"},{"type":"text","text":"pull request who probably doesn’t have time to do that for every review this"},{"type":"text","text":" "},{"type":"text","text":"tool is fantastic."}]},{"type":"paragraph","inlineContent":[{"text":"Anyhow, I hope I’ve convinced you to at least try the accessibility snapshot","type":"text"},{"type":"text","text":" "},{"text":"tests and we can move on to adding them to our hosted tests.","type":"text"}]},{"inlineContent":[{"text":"Our first step is to add the Accessibility Snapshot Testing dependency to our","type":"text"},{"type":"text","text":" "},{"text":"app project, and specifically the hosted tests target (just like for the","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"snapshot testing dependency). But unfortunately the current version of the"},{"type":"text","text":" "},{"type":"text","text":"Accessibility Snapshot Testing library does not support precision or perceptual"},{"type":"text","text":" "},{"type":"text","text":"precision which are both things we need since we are working across Apple"},{"text":" ","type":"text"},{"type":"text","text":"Silicon and Intel machines and each of those machines renders things just"},{"type":"text","text":" "},{"text":"differently enough to not completely match snapshots from the other processor","type":"text"},{"type":"text","text":" "},{"type":"text","text":"type (not needing to set these precision parameters in my first blog post was"},{"text":" ","type":"text"},{"type":"text","text":"the surprising thing I alluded to near the beginning of this post). Those things"},{"text":" ","type":"text"},{"type":"text","text":"cannot easily be added to the library because:"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Accessibility Snapshot Testing supports CocoaPods, and","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"Swift Snapshot Testing dropped support for CocoaPods at the same time it","type":"text"},{"type":"text","text":" "},{"type":"text","text":"added perceptual precision"}],"type":"paragraph"}]}],"type":"orderedList"},{"inlineContent":[{"text":"To work around this I’ve ","type":"text"},{"type":"reference","identifier":"https:\/\/gist.github.com\/DavidBrunow\/9aade5980649c660d73795d7c9b5b056","isActive":true},{"type":"text","text":" inspired by"},{"type":"text","text":" "},{"type":"reference","identifier":"https:\/\/github.com\/cashapp\/AccessibilitySnapshot\/pull\/143","isActive":true},{"text":".","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"This allows us to set the precision and perceptual precision on our"},{"type":"text","text":" "},{"type":"text","text":"accessibility snapshots. Next I’ll share the code that implements my opinions"},{"type":"text","text":" "},{"text":"and ties everything together.","type":"text"}],"type":"paragraph"},{"level":3,"type":"heading","anchor":"My-opinionated-helper-code","text":"My opinionated helper code"},{"type":"paragraph","inlineContent":[{"type":"text","text":"This mostly builds upon the"},{"type":"text","text":" "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Brunow\/documentation\/Brunow\/08-30-snapshot-testing-with-xcode-cloud#Creating-Something-Reusable","overridingTitle":"helper code I shared in my snapshot tests on Xcode Cloud post","overridingTitleInlineContent":[{"type":"text","text":"helper code I shared in my snapshot tests on Xcode Cloud post"}]},{"text":" ","type":"text"},{"type":"text","text":"but adds “throwaway” and accessiblity snapshots and provides values for"},{"type":"text","text":" "},{"type":"text","text":"precision and perceptual precision that work consistently for me. This helper"},{"type":"text","text":" "},{"type":"text","text":"has strong opinions and does not provide the user with a lot of flexibility —"},{"text":" ","type":"text"},{"text":"and where there is flexibility the API provides a default value so that most of","type":"text"},{"type":"text","text":" "},{"type":"text","text":"the time users would not have to think about those options. Hopefully making"},{"type":"text","text":" "},{"text":"these decisions for the user provides a simpler user experience that “just","type":"text"},{"type":"text","text":" "},{"type":"text","text":"works”."}]},{"inlineContent":[{"type":"text","text":"Here is a "},{"isActive":true,"type":"reference","identifier":"https:\/\/gist.github.com\/DavidBrunow\/abb67bb0dda59d9524ae9868c926e810"},{"type":"text","text":"."},{"type":"text","text":" "},{"text":"Note that some of the decisions I’ve made may not work for you. For example,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"I’ve added a check to make sure that the first preferred language on the"},{"type":"text","text":" "},{"type":"text","text":"simulator running the tests is English (US). This is because I am an American"},{"text":" ","type":"text"},{"type":"text","text":"and the primary language I use is American English and this ensures that I don’t"},{"text":" ","type":"text"},{"type":"text","text":"accidentally get to a place where all my tests are failing with an extra “u” in"},{"type":"text","text":" "},{"text":"the word “color” if I’ve set my simulator’s primary language to English (UK).","type":"text"},{"type":"text","text":" "},{"text":"The tests will still fail with this check but they will fail with a useful error","type":"text"},{"type":"text","text":" "},{"text":"message. You may want to change that check to test for your preferred language.","type":"text"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"This helper uses another "},{"identifier":"https:\/\/gist.github.com\/DavidBrunow\/c7fa841ecd61526a660367c32a093a0c","isActive":true,"type":"reference"},{"type":"text","text":" which I pulled from"},{"type":"text","text":" "},{"identifier":"https:\/\/stackoverflow.com\/a\/26962452","type":"reference","isActive":true},{"type":"text","text":" to be able to check"},{"type":"text","text":" "},{"type":"text","text":"whether the right simulator is being used for the snapshots."}]},{"type":"paragraph","inlineContent":[{"text":"These two helpers and the shim I created for accessibility snapshot testing all","type":"text"},{"text":" ","type":"text"},{"text":"need to be copied into your hosted tests target.","type":"text"}]},{"inlineContent":[{"text":"Using these helpers, this is what the callsite for running the standard tests","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"would look like:"}],"type":"paragraph"},{"syntax":"swift","code":["...","  assertStandardSnapshots(","    content: Text(\"I am going to be snapshot!\"),","    named: \"Sample Text\"","  )","..."],"type":"codeListing"}]}],"abstract":[{"type":"text","text":"Stumbling over complexity and hiding it with opinions."}],"variants":[{"paths":["\/documentation\/brunow\/10-21-here-be-dragons-snapshot-testing-edition"],"traits":[{"interfaceLanguage":"swift"}]}],"hierarchy":{"paths":[["doc:\/\/Brunow\/documentation\/Brunow"],["doc:\/\/Brunow\/documentation\/Brunow","doc:\/\/Brunow\/documentation\/Brunow\/Archive","doc:\/\/Brunow\/documentation\/Brunow\/2023"]]},"references":{"arabicOrArmenianTestFailure":{"variants":[{"url":"\/images\/arabicOrArmenianTestFailure@2x.png","traits":["2x","light"]}],"identifier":"arabicOrArmenianTestFailure","alt":"Screenshot showing a test failure about the simulator having Arabic or Armenian in its preferred languages.","type":"image"},"https://github.com/apple/swift-docc/issues/737":{"title":"issue on the Swift-DocC project","url":"https:\/\/github.com\/apple\/swift-docc\/issues\/737","type":"link","titleInlineContent":[{"text":"issue on the Swift-DocC project","type":"text"}],"identifier":"https:\/\/github.com\/apple\/swift-docc\/issues\/737"},"accessibilitySnapshotTestExample":{"variants":[{"url":"\/images\/accessibilitySnapshotTestExample@3x.png","traits":["3x","light"]}],"identifier":"accessibilitySnapshotTestExample","alt":"Accessiblity snapshot showing a snapshot of the user interface on the left. The snapshot of the user interface has colored rectangles over different elements which match up to the VoiceOver text that will be spoken for that element on the right.","type":"image"},"https://github.com/pointfreeco/swift-snapshot-testing/discussions/797":{"title":"discussion","url":"https:\/\/github.com\/pointfreeco\/swift-snapshot-testing\/discussions\/797","type":"link","titleInlineContent":[{"text":"discussion","type":"text"}],"identifier":"https:\/\/github.com\/pointfreeco\/swift-snapshot-testing\/discussions\/797"},"https://github.com/pointfreeco/swift-snapshot-testing/blob/main/Sources/SnapshotTesting/Snapshotting/UIViewController.swift#L48":{"titleInlineContent":[{"text":"the snapshot testing documentation around ","type":"text"},{"type":"codeVoice","code":"UIViewController"},{"type":"text","text":" snapshot strategies"}],"identifier":"https:\/\/github.com\/pointfreeco\/swift-snapshot-testing\/blob\/main\/Sources\/SnapshotTesting\/Snapshotting\/UIViewController.swift#L48","title":"the snapshot testing documentation around UIViewController snapshot strategies","url":"https:\/\/github.com\/pointfreeco\/swift-snapshot-testing\/blob\/main\/Sources\/SnapshotTesting\/Snapshotting\/UIViewController.swift#L48","type":"link"},"doc://Brunow/documentation/Brunow/08-30-snapshot-testing-with-xcode-cloud#Create-a-symlink-in-the-ciscripts-directory-to-where-our-snapshots-are-stored":{"abstract":[],"title":"Create a symlink in the ci_scripts directory to where our snapshots are stored","kind":"section","url":"\/documentation\/brunow\/08-30-snapshot-testing-with-xcode-cloud#Create-a-symlink-in-the-ciscripts-directory-to-where-our-snapshots-are-stored","type":"topic","identifier":"doc:\/\/Brunow\/documentation\/Brunow\/08-30-snapshot-testing-with-xcode-cloud#Create-a-symlink-in-the-ciscripts-directory-to-where-our-snapshots-are-stored"},"miscoloredTabBar":{"variants":[{"url":"\/images\/miscoloredTabBar@3x.png","traits":["3x","light"]}],"identifier":"miscoloredTabBar","alt":"Screenshot of my app’s miscolored tab bar. The tab bar icons are white on a light gray background which makes them difficult to see.","type":"image"},"diffBetweenDrawHierarchyKeyWindowUIWindow":{"variants":[{"url":"\/images\/diffBetweenDrawHierarchyKeyWindowUIWindow@3x.png","traits":["3x","light"]}],"type":"image","alt":"Shows difference between the snapshot taken with the key window and the snapshot taken with a UIWindow. The snapshot taken with the UIWindow looks the same other than the tab bar is lower on the screen.","identifier":"diffBetweenDrawHierarchyKeyWindowUIWindow"},"misrenderedSwiftUIList.png":{"variants":[{"url":"\/images\/misrenderedSwiftUIList@3x.png","traits":["3x","light"]}],"identifier":"misrenderedSwiftUIList.png","alt":null,"type":"image"},"https://github.com/pointfreeco/swift-snapshot-testing/pull/796":{"title":"a pull request with suggestions for that","url":"https:\/\/github.com\/pointfreeco\/swift-snapshot-testing\/pull\/796","type":"link","titleInlineContent":[{"text":"a pull request with","type":"text"},{"type":"text","text":" "},{"type":"text","text":"suggestions for that"}],"identifier":"https:\/\/github.com\/pointfreeco\/swift-snapshot-testing\/pull\/796"},"doc://Brunow/documentation/Brunow/08-30-snapshot-testing-with-xcode-cloud#Creating-Something-Reusable":{"abstract":[],"kind":"section","identifier":"doc:\/\/Brunow\/documentation\/Brunow\/08-30-snapshot-testing-with-xcode-cloud#Creating-Something-Reusable","title":"Creating Something Reusable","url":"\/documentation\/brunow\/08-30-snapshot-testing-with-xcode-cloud#Creating-Something-Reusable","type":"topic"},"https://github.com/pointfreeco/swift-snapshot-testing/issues/667#issuecomment-1463810906":{"title":"someone commented that it did not work for them","url":"https:\/\/github.com\/pointfreeco\/swift-snapshot-testing\/issues\/667#issuecomment-1463810906","type":"link","titleInlineContent":[{"text":"someone commented that it did not work for them","type":"text"}],"identifier":"https:\/\/github.com\/pointfreeco\/swift-snapshot-testing\/issues\/667#issuecomment-1463810906"},"https://stackoverflow.com/a/25704861":{"titleInlineContent":[{"text":"this interesting StackOverflow post","type":"text"}],"identifier":"https:\/\/stackoverflow.com\/a\/25704861","title":"this interesting StackOverflow post","url":"https:\/\/stackoverflow.com\/a\/25704861","type":"link"},"doc://Brunow/documentation/Brunow/08-30-snapshot-testing-with-xcode-cloud":{"images":[{"type":"card","identifier":"snapshotTestFailures.png"}],"title":"Snapshot Testing with Xcode Cloud","type":"topic","abstract":[{"type":"text","text":"Working around unexpectedly sharp edges when using snapshot tests."}],"role":"article","kind":"article","url":"\/documentation\/brunow\/08-30-snapshot-testing-with-xcode-cloud","identifier":"doc:\/\/Brunow\/documentation\/Brunow\/08-30-snapshot-testing-with-xcode-cloud"},"https://developer.apple.com/documentation/uikit/uiview/1622589-drawhierarchy":{"titleInlineContent":[{"code":"drawHierarchy(in:afterScreenUpdates:)","type":"codeVoice"}],"identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uiview\/1622589-drawhierarchy","title":"drawHierarchy(in:afterScreenUpdates:)","url":"https:\/\/developer.apple.com\/documentation\/uikit\/uiview\/1622589-drawhierarchy","type":"link"},"doc://Brunow/documentation/Brunow/Archive":{"url":"\/documentation\/brunow\/archive","kind":"article","identifier":"doc:\/\/Brunow\/documentation\/Brunow\/Archive","title":"Archive","type":"topic","abstract":[{"type":"text","text":"All posts"}],"role":"collectionGroup"},"doc://Brunow/documentation/Brunow/11-30-follow-up-snapshot-testing-xcode-cloud-sonoma":{"title":"Follow up: Snapshot Testing with Xcode Cloud on Sonoma","type":"topic","abstract":[{"type":"text","text":"Working around a change in simulator configuration."}],"role":"article","kind":"article","url":"\/documentation\/brunow\/11-30-follow-up-snapshot-testing-xcode-cloud-sonoma","identifier":"doc:\/\/Brunow\/documentation\/Brunow\/11-30-follow-up-snapshot-testing-xcode-cloud-sonoma"},"#Using-strong-opinions-in-higher-level-libraries":{"titleInlineContent":[{"text":"I’ve figured out that  having certain locales setup as preferred languages in a simulator causes different rendering","type":"text"}],"identifier":"#Using-strong-opinions-in-higher-level-libraries","title":"I’ve figured out that  having certain locales setup as preferred languages in a simulator causes different rendering","url":"#Using-strong-opinions-in-higher-level-libraries","type":"link"},"https://developer.apple.com/documentation/uikit/uiapplication/1622924-keywindow":{"title":"key window","url":"https:\/\/developer.apple.com\/documentation\/uikit\/uiapplication\/1622924-keywindow","type":"link","titleInlineContent":[{"text":"key window","type":"text"}],"identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uiapplication\/1622924-keywindow"},"doc://Brunow/documentation/Brunow":{"identifier":"doc:\/\/Brunow\/documentation\/Brunow","abstract":[{"type":"text","text":"David Brunow, known as Brunow [ˈbɹunoʊ] to the folks he works with, is a human living on Earth. You might have something in common with him — if you think it is ridiculous that he is talking about himself in the first person here, so does he."}],"title":"Brunow","role":"collection","type":"topic","kind":"symbol","url":"\/documentation\/brunow"},"doc://Brunow/documentation/Brunow/2023":{"abstract":[],"kind":"article","identifier":"doc:\/\/Brunow\/documentation\/Brunow\/2023","type":"topic","title":"2023","role":"collectionGroup","url":"\/documentation\/brunow\/2023"},"https://softwareengineering.stackexchange.com/a/358792":{"identifier":"https:\/\/softwareengineering.stackexchange.com\/a\/358792","url":"https:\/\/softwareengineering.stackexchange.com\/a\/358792","title":"“golden”","titleInlineContent":[{"text":"“golden”","type":"text"}],"type":"link"},"https://developer.apple.com/fonts/":{"type":"link","url":"https:\/\/developer.apple.com\/fonts\/","title":"Apple website about their fonts","titleInlineContent":[{"text":"Apple website about their fonts","type":"text"}],"identifier":"https:\/\/developer.apple.com\/fonts\/"},"https://github.com/pointfreeco/swift-snapshot-testing":{"type":"link","title":"Point-Free Snapshot Testing library","url":"https:\/\/github.com\/pointfreeco\/swift-snapshot-testing","titleInlineContent":[{"type":"text","text":"Point-Free Snapshot Testing library"}],"identifier":"https:\/\/github.com\/pointfreeco\/swift-snapshot-testing"},"https://github.com/pointfreeco/swift-snapshot-testing/issues/667":{"titleInlineContent":[{"text":"this GitHub issue","type":"text"}],"title":"this GitHub issue","url":"https:\/\/github.com\/pointfreeco\/swift-snapshot-testing\/issues\/667","identifier":"https:\/\/github.com\/pointfreeco\/swift-snapshot-testing\/issues\/667","type":"link"},"https://gist.github.com/DavidBrunow/abb67bb0dda59d9524ae9868c926e810":{"type":"link","title":"gist with my helper code","url":"https:\/\/gist.github.com\/DavidBrunow\/abb67bb0dda59d9524ae9868c926e810","titleInlineContent":[{"type":"text","text":"gist with my helper code"}],"identifier":"https:\/\/gist.github.com\/DavidBrunow\/abb67bb0dda59d9524ae9868c926e810"},"misrenderedSwiftUIList":{"variants":[{"traits":["3x","light"],"url":"\/images\/misrenderedSwiftUIList@3x.png"}],"alt":"Screenshot of a SwiftUI List in my app. Each row in the list has slightly rounded corners that make it look goofy.","identifier":"misrenderedSwiftUIList","type":"image"},"https://github.com/pointfreeco/swift-snapshot-testing/blob/main/Sources/SnapshotTesting/Common/View.swift#L940C36-L940C36":{"type":"link","title":"line 940 of View.swift","url":"https:\/\/github.com\/pointfreeco\/swift-snapshot-testing\/blob\/main\/Sources\/SnapshotTesting\/Common\/View.swift#L940C36-L940C36","titleInlineContent":[{"text":"line 940 of View.swift","type":"text"}],"identifier":"https:\/\/github.com\/pointfreeco\/swift-snapshot-testing\/blob\/main\/Sources\/SnapshotTesting\/Common\/View.swift#L940C36-L940C36"},"numberOfPreferredLanguagesXcodeCloudSonoma":{"variants":[{"traits":["2x","light"],"url":"\/images\/numberOfPreferredLanguagesXcodeCloudSonoma@2x.png"}],"alt":"Screenshot showing that the simulator running on macOS Sonoma has 34 preferred languages.","identifier":"numberOfPreferredLanguagesXcodeCloudSonoma","type":"image"},"https://forums.swift.org/t/host-application-for-spm-tests/24363":{"type":"link","title":"this thread on the Swift forums","url":"https:\/\/forums.swift.org\/t\/host-application-for-spm-tests\/24363","titleInlineContent":[{"text":"this thread on the Swift forums","type":"text"}],"identifier":"https:\/\/forums.swift.org\/t\/host-application-for-spm-tests\/24363"},"https://gist.github.com/DavidBrunow/9aade5980649c660d73795d7c9b5b056":{"titleInlineContent":[{"text":"created a shim","type":"text"}],"title":"created a shim","url":"https:\/\/gist.github.com\/DavidBrunow\/9aade5980649c660d73795d7c9b5b056","identifier":"https:\/\/gist.github.com\/DavidBrunow\/9aade5980649c660d73795d7c9b5b056","type":"link"},"https://github.com/pointfreeco/swift-snapshot-testing/issues/667#issuecomment-1462270406":{"type":"link","title":"a potential solution","url":"https:\/\/github.com\/pointfreeco\/swift-snapshot-testing\/issues\/667#issuecomment-1462270406","titleInlineContent":[{"text":"a potential solution","type":"text"}],"identifier":"https:\/\/github.com\/pointfreeco\/swift-snapshot-testing\/issues\/667#issuecomment-1462270406"},"https://developer.apple.com/documentation/quartzcore/calayer/1410909-render":{"titleInlineContent":[{"type":"codeVoice","code":"render(in:)"}],"title":"render(in:)","url":"https:\/\/developer.apple.com\/documentation\/quartzcore\/calayer\/1410909-render","identifier":"https:\/\/developer.apple.com\/documentation\/quartzcore\/calayer\/1410909-render","type":"link"},"https://github.com/feedback-assistant/reports/issues/430":{"type":"link","title":"FB13292311","url":"https:\/\/github.com\/feedback-assistant\/reports\/issues\/430","titleInlineContent":[{"text":"FB13292311","type":"text"}],"identifier":"https:\/\/github.com\/feedback-assistant\/reports\/issues\/430"},"https://github.com/cashapp/AccessibilitySnapshot":{"titleInlineContent":[{"text":"library","type":"text"}],"title":"library","url":"https:\/\/github.com\/cashapp\/AccessibilitySnapshot","identifier":"https:\/\/github.com\/cashapp\/AccessibilitySnapshot","type":"link"},"https://github.com/cashapp/AccessibilitySnapshot/pull/143":{"type":"link","title":"this pull request","url":"https:\/\/github.com\/cashapp\/AccessibilitySnapshot\/pull\/143","titleInlineContent":[{"text":"this pull request","type":"text"}],"identifier":"https:\/\/github.com\/cashapp\/AccessibilitySnapshot\/pull\/143"},"https://github.com/cashapp/AccessibilitySnapshot/issues/168":{"url":"https:\/\/github.com\/cashapp\/AccessibilitySnapshot\/issues\/168","title":"an issue on the Accessibility Snapshot Testing library","type":"link","identifier":"https:\/\/github.com\/cashapp\/AccessibilitySnapshot\/issues\/168","titleInlineContent":[{"text":"an issue on the Accessibility Snapshot Testing library","type":"text"}]},"https://gist.github.com/DavidBrunow/c7fa841ecd61526a660367c32a093a0c":{"titleInlineContent":[{"text":"helper extension on ","type":"text"},{"type":"codeVoice","code":"UIDevice"}],"title":"helper extension on UIDevice","url":"https:\/\/gist.github.com\/DavidBrunow\/c7fa841ecd61526a660367c32a093a0c","identifier":"https:\/\/gist.github.com\/DavidBrunow\/c7fa841ecd61526a660367c32a093a0c","type":"link"},"snapshotTestFailures.png":{"type":"image","variants":[{"url":"\/images\/snapshotTestFailures.png","traits":["1x","light"]}],"identifier":"snapshotTestFailures.png","alt":"Screenshot of snapshot test failures from Xcode Cloud."},"https://en.wikipedia.org/wiki/Here_be_dragons":{"titleInlineContent":[{"text":"Here Be Dragons (HC SVNT DRACONES) on Wikipedia","type":"text"}],"title":"Here Be Dragons (HC SVNT DRACONES) on Wikipedia","url":"https:\/\/en.wikipedia.org\/wiki\/Here_be_dragons","identifier":"https:\/\/en.wikipedia.org\/wiki\/Here_be_dragons","type":"link"},"https://github.com/feedback-assistant/reports/issues/431":{"url":"https:\/\/github.com\/feedback-assistant\/reports\/issues\/431","title":"FB13288344","type":"link","identifier":"https:\/\/github.com\/feedback-assistant\/reports\/issues\/431","titleInlineContent":[{"text":"FB13288344","type":"text"}]},"https://github.com/pointfreeco/swift-snapshot-testing/blob/main/Sources/SnapshotTesting/Common/View.swift#L990C46-L990C46":{"titleInlineContent":[{"text":"this conditional in ","type":"text"},{"type":"codeVoice","code":"View.swift"}],"title":"this conditional in View.swift","url":"https:\/\/github.com\/pointfreeco\/swift-snapshot-testing\/blob\/main\/Sources\/SnapshotTesting\/Common\/View.swift#L990C46-L990C46","identifier":"https:\/\/github.com\/pointfreeco\/swift-snapshot-testing\/blob\/main\/Sources\/SnapshotTesting\/Common\/View.swift#L990C46-L990C46","type":"link"},"https://stackoverflow.com/a/26962452":{"url":"https:\/\/stackoverflow.com\/a\/26962452","title":"Stack Overflow","type":"link","identifier":"https:\/\/stackoverflow.com\/a\/26962452","titleInlineContent":[{"text":"Stack Overflow","type":"text"}]}}}