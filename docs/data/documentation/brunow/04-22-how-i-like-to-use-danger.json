{"metadata":{"color":{"standardColorIdentifier":"purple"},"platforms":[{"introducedAt":"2024.04.22","name":"Brunow"}],"title":"How I Like to Use Danger","modules":[{"name":"Brunow"}],"images":[{"identifier":"exampleDangerReport.png","type":"card"}]},"kind":"article","hierarchy":{"paths":[["doc:\/\/Brunow\/documentation\/Brunow"],["doc:\/\/Brunow\/documentation\/Brunow","doc:\/\/Brunow\/documentation\/Brunow\/Archive","doc:\/\/Brunow\/documentation\/Brunow\/2024"]]},"sections":[],"identifier":{"url":"doc:\/\/Brunow\/documentation\/Brunow\/04-22-how-i-like-to-use-danger","interfaceLanguage":"swift"},"topicSectionsStyle":"detailedGrid","primaryContentSections":[{"kind":"content","content":[{"type":"heading","text":"Overview","anchor":"Overview","level":2},{"type":"paragraph","inlineContent":[{"type":"text","text":"Danger is a tool that connects your CI build systems to your pull requests. This"},{"text":" ","type":"text"},{"text":"provides an excellent developer experience where (most of the time) they can","type":"text"},{"type":"text","text":" "},{"type":"text","text":"know whether a pull request is in a healthy state by looking at a comment"},{"type":"text","text":" "},{"text":"directly on that pull request.","type":"text"}]},{"inlineContent":[{"text":"This connection between the CI build systems and the pull request allows teams","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"to implement automated code health tools which can give quick feedback to about:"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"Warnings introduced by the changes"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Linting and code formatting errors based upon agreed-upon standards","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Code coverage percentages","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"Any other information which can be automated","type":"text"}],"type":"paragraph"}]}]},{"inlineContent":[{"type":"text","text":"Danger has two base implementations, one in Ruby and one in JavaScript. On top"},{"text":" ","type":"text"},{"text":"of that, there are Danger runners written in Kotlin and Swift which hand off the","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"bulk of the work to Danger JS but allow for Dangerfiles, the file which define"},{"text":" ","type":"text"},{"type":"text","text":"what Danger should do, written in languages that will be more familiar to"},{"type":"text","text":" "},{"type":"text","text":"mobile developers. I prefer to use Danger Kotlin when building CI for Android or"},{"type":"text","text":" "},{"text":"other Java-based projects and Danger Swift when building CI for Apple","type":"text"},{"type":"text","text":" "},{"type":"text","text":"platforms, because I find it is easier to get folks involved in CI code when it"},{"type":"text","text":" "},{"type":"text","text":"is in a language they use every day. It is also more likely that folks in a"},{"text":" ","type":"text"},{"type":"text","text":"specific community will create plugins for Danger that you could find useful –"},{"text":" ","type":"text"},{"type":"text","text":"folks using Danger Swift will be more likely to create plugins around Xcode and"},{"text":" ","type":"text"},{"type":"text","text":"other Apple tooling than folks using Danger Kotlin would."}],"type":"paragraph"},{"inlineContent":[{"text":"OK I think that is enough of an intro to Danger, next I’ll talk through the","type":"text"},{"type":"text","text":" "},{"text":"flexibility built-in to Danger through its plugin system.","type":"text"}],"type":"paragraph"},{"level":2,"type":"heading","text":"Danger’s Architecture","anchor":"Dangers-Architecture"},{"inlineContent":[{"type":"text","text":"Danger is architected to allow for anyone to create their own plugins that can"},{"type":"text","text":" "},{"type":"text","text":"provide information to Danger which can then be shown on a pull request. I’ve"},{"type":"text","text":" "},{"text":"relied on this ability to add plugins to add extra checks that are specific to","type":"text"},{"text":" ","type":"text"},{"text":"our codebase, like a localization linter which ensured that Xcode’s command line","type":"text"},{"type":"text","text":" "},{"text":"tools could extract keys for localization. Out-of-the-box, Danger allows for","type":"text"},{"type":"text","text":" "},{"type":"text","text":"these plugins to be dynamically included at run time which is a lot of"},{"type":"text","text":" "},{"text":"flexibility, especially when using statically typed languages like Kotlin and","type":"text"},{"type":"text","text":" "},{"text":"Swift.","type":"text"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"This plugin architecture is very clever and lets people get started with Danger"},{"text":" ","type":"text"},{"type":"text","text":"quite easily. But it is a bit complex. Let’s talk through the moving pieces in"},{"text":" ","type":"text"},{"type":"text","text":"Danger Swift, all of which applies to Danger Kotlin as well:"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"The Dangerfile"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"The Danger Swift Library"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"The Danger Swift Runner"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"The Danger JS Runner","type":"text"}]}]}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Here is how they are all connected. The Danger Swift runner builds and runs the"},{"type":"text","text":" "},{"type":"text","text":"Dangerfile while linking in the Danger Swift library. The Danger Swift runner"},{"text":" ","type":"text"},{"type":"text","text":"then uses the Danger JS runner to interact with the source control platforms"},{"type":"text","text":" "},{"text":"(GitHub, GitLab, BitBucket, etc). Let’s talk through each of these components in","type":"text"},{"text":" ","type":"text"},{"text":"detail.","type":"text"}]},{"anchor":"The-Dangerfile","type":"heading","level":3,"text":"The Dangerfile"},{"inlineContent":[{"type":"text","text":"The Dangerfile, "},{"code":"Dangerfile.swift","type":"codeVoice"},{"text":" for Danger Swift, is the code file that","type":"text"},{"type":"text","text":" "},{"text":"defines everything that Danger will do when Danger is run in a CI pipeline. Here","type":"text"},{"type":"text","text":" "},{"text":"is a simplified example of a Dangerfile from","type":"text"},{"type":"text","text":" "},{"isActive":true,"type":"reference","identifier":"https:\/\/danger.systems\/swift\/"},{"type":"text","text":":"}],"type":"paragraph"},{"code":["import Danger","let danger = Danger()","","\/\/ Add a CHANGELOG entry for app changes","let hasChangelog = danger.git.modifiedFiles.contains(\"changelog.md\")","","if (!hasChangelog) {","    warn(\"Please add a changelog entry for your changes.\")","}"],"type":"codeListing","syntax":"swift"},{"type":"paragraph","inlineContent":[{"text":"This simple example checks to see if the ","type":"text"},{"code":"changelog.md","type":"codeVoice"},{"text":" file has been modified","type":"text"},{"type":"text","text":" "},{"type":"text","text":"as part of the pull request and, if not, adds a warning to the pull request"},{"type":"text","text":" "},{"type":"text","text":"letting the developer know that they need to update the changelog. Providing"},{"type":"text","text":" "},{"text":"that feedback through this automation means that a contributor to a repo can","type":"text"},{"type":"text","text":" "},{"type":"text","text":"quickly learn what changes they need to make to meet the standards of that repo."},{"type":"text","text":" "},{"type":"text","text":"Plus, the maintainer of the repo can focus on things only humans can do, like"},{"type":"text","text":" "},{"type":"text","text":"making sure that the pull request follows their architectural guidelines."}]},{"inlineContent":[{"text":"At the beginning of every Dangerfile, the Danger library must be imported. Let’s","type":"text"},{"type":"text","text":" "},{"type":"text","text":"talk about how that works next."}],"type":"paragraph"},{"level":3,"text":"The Danger Swift Library","anchor":"The-Danger-Swift-Library","type":"heading"},{"type":"paragraph","inlineContent":[{"type":"text","text":"The Danger Swift library is what powers the different things you can do in a"},{"type":"text","text":" "},{"type":"text","text":"Dangerfile. The library is built with the core Danger functionality plus any"},{"text":" ","type":"text"},{"type":"text","text":"plugins that you’ve chosen to integrate. The documentation recommends"},{"type":"text","text":" "},{"type":"text","text":"integrating Danger into your workflow by"},{"text":" ","type":"text"},{"identifier":"https:\/\/danger.systems\/swift\/guides\/about_the_dangerfile#swift-package-manager-more-performant","type":"reference","isActive":true},{"type":"text","text":"."},{"text":" ","type":"text"},{"text":"This allows the Danger Swift library to be built as-needed with just the plugins","type":"text"},{"type":"text","text":" "},{"type":"text","text":"you’ve defined and puts everything in the right place so Swift can find the"},{"type":"text","text":" "},{"type":"text","text":"library when running the Dangerfile."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"I’m not a fan of this approach but I’ll talk through that later when I go"},{"text":" ","type":"text"},{"text":"through how I like to use Danger.","type":"text"}]},{"type":"heading","text":"The Danger Swift Runner","level":3,"anchor":"The-Danger-Swift-Runner"},{"type":"paragraph","inlineContent":[{"type":"text","text":"The Danger Swift runner is a fairly simple tool that ties everything together."},{"type":"text","text":" "},{"type":"text","text":"As mentioned before, it runs the Dangerfile while also providing the path to the"},{"type":"text","text":" "},{"type":"text","text":"Danger Swift library. This could easily be a standalone executable, but in the"},{"text":" ","type":"text"},{"text":"recommended setup, linked above in the Danger Swift library section, the runner","type":"text"},{"type":"text","text":" "},{"text":"is re-built through Swift Package Manager every time it is needed to be run.","type":"text"}]},{"inlineContent":[{"type":"text","text":"In addition to running the Dangerfile, the Danger Swift runner runs the Danger"},{"type":"text","text":" "},{"text":"JS runner, which handles all communication with the source control platforms.","type":"text"}],"type":"paragraph"},{"anchor":"The-Danger-JS-Runner","level":3,"type":"heading","text":"The Danger JS Runner"},{"inlineContent":[{"text":"As mentioned before, the Danger JS runner is the common tool across the","type":"text"},{"type":"text","text":" "},{"text":"different Danger “front-ends” (Danger Swift, Danger Kotlin, etc.) that handles","type":"text"},{"type":"text","text":" "},{"text":"all the interactions with source control platforms. These interactions are","type":"text"},{"type":"text","text":" "},{"text":"bi-directional because the Dangerfile needs access to information from those","type":"text"},{"type":"text","text":" "},{"text":"platforms and also needs to send information to them for warnings, errors, and","type":"text"},{"text":" ","type":"text"},{"text":"informational messages.","type":"text"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Strangely, I don’t see anything about how to install Danger JS, or even the need"},{"text":" ","type":"text"},{"type":"text","text":"to do so, in "},{"identifier":"https:\/\/danger.systems\/swift\/guides\/getting_started","type":"reference","isActive":true},{"type":"text","text":". I"},{"text":" ","type":"text"},{"type":"text","text":"prefer to install Danger JS through npm, which I prefer to install through"},{"type":"text","text":" "},{"text":"Homebrew. Here are the steps to do that:","type":"text"}]},{"code":["brew install node","npm install -g danger"],"type":"codeListing","syntax":"sh"},{"anchor":"How-I-Setup-Danger","text":"How I Setup Danger","level":2,"type":"heading"},{"type":"paragraph","inlineContent":[{"text":"Now that we know how all the pieces fit together, I’ll gripe about the things","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"I don’t like about this approach and talk about how I like to set things up."}]},{"type":"heading","level":3,"anchor":"Gripes","text":"Gripes"},{"inlineContent":[{"type":"text","text":"All of my gripes revolve around the need to use Swift Package Manager to build"},{"text":" ","type":"text"},{"text":"and run the runner and library:","type":"text"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"I don’t like to mix tooling and my app’s dependencies","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"I don’t always want to use SPM","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"I don’t want to re-build Danger on every run","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"The recommended approach is invasive to my project, requiring me to add a"},{"text":" ","type":"text"},{"type":"text","text":"folder that will not be used"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Due to the invasive nature of the recommended approach, applying the same"},{"text":" ","type":"text"},{"type":"text","text":"Danger configurations across multiple repos, and keeping those configurations in"},{"type":"text","text":" "},{"text":"sync, it creates a lot of manual overhead","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"I like pre-built binaries"}]}]}]},{"type":"paragraph","inlineContent":[{"text":"What I want is a pre-built executable for the Danger Swift runner, and a","type":"text"},{"type":"text","text":" "},{"text":"pre-built framework for the Danger Swift library. Let’s talk about how I make","type":"text"},{"type":"text","text":" "},{"text":"that work.","type":"text"}]},{"anchor":"My-Setup","text":"My Setup","level":3,"type":"heading"},{"style":"note","content":[{"inlineContent":[{"type":"text","text":"This setup requires a fork of Danger Swift."}],"type":"paragraph"}],"type":"aside","name":"Note"},{"level":4,"type":"heading","anchor":"The-Runner","text":"The Runner"},{"type":"paragraph","inlineContent":[{"type":"text","text":"The Danger Swift runner is already meant to be a standalone executable, so we"},{"text":" ","type":"text"},{"text":"don’t need to do too much there. We want to make sure that it is built as a","type":"text"},{"type":"text","text":" "},{"type":"text","text":"universal binary so it can run on both Apple Silicon and Intel, so we can build"},{"text":" ","type":"text"},{"type":"text","text":"it like this:"}]},{"syntax":"sh","type":"codeListing","code":["swift build -c release --arch arm64 --arch x86_64"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Swift builds the "},{"type":"codeVoice","code":"danger-swift"},{"type":"text","text":" binary and puts it in the"},{"text":" ","type":"text"},{"type":"text","text":"“.build\/apple\/Products\/Release\/danger-swift” folder so we’ll need to copy it"},{"type":"text","text":" "},{"text":"from there to where we need it. All of that is simple and straightforward.","type":"text"}]},{"text":"The Library","level":4,"type":"heading","anchor":"The-Library"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Building the library in a portable way isn’t quite as nice, but we’ll get to"},{"type":"text","text":" "},{"text":"that in a moment. First, since we want a portable library that can be used","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"anywhere, we need to find a way to build that library with all the plugins we"},{"type":"text","text":" "},{"text":"need. This approach requires choosing your plugins ahead of time and not being","type":"text"},{"type":"text","text":" "},{"text":"able to do so at run time – if you want a new plugin you’ll need to rebuild and","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"redistribute the library."}]},{"type":"heading","text":"Integrating Plugins","level":5,"anchor":"Integrating-Plugins"},{"inlineContent":[{"type":"text","text":"Fortunately, Danger Swift has already gone through the process of integrating a"},{"type":"text","text":" "},{"text":"common plugin, SwiftLint, into the library so we can follow the maintainer’s","type":"text"},{"type":"text","text":" "},{"type":"text","text":"lead and do the same thing for our plugins. There is already a “Plugins” folder"},{"text":" ","type":"text"},{"text":"in the “Sources\/Danger” folder and adding our plugin there is quite simple – we","type":"text"},{"type":"text","text":" "},{"text":"copy the source code folder into the “Plugins” folder and then make whatever","type":"text"},{"type":"text","text":" "},{"type":"text","text":"changes are need to make the Danger library successfully compile again. Doing"},{"type":"text","text":" "},{"text":"that requires fixing any naming conflicts and, while we’re in there, we’ll fix","type":"text"},{"type":"text","text":" "},{"text":"warnings around importing Danger by removing any ","type":"text"},{"code":"import Danger","type":"codeVoice"},{"text":" code. Let’s","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"walk through an example with a popular plugin, "},{"type":"reference","identifier":"https:\/\/github.com\/f-meloni\/danger-swift-coverage","isActive":true},{"type":"text","text":","},{"text":" ","type":"text"},{"type":"text","text":"which gathers code coverage so it can be posted on pull requests."}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Fork Danger Swift and clone the fork to your machine"}]}]},{"content":[{"inlineContent":[{"text":"Clone DangerSwiftCoverage to your machine","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Copy the “Sources\/DangerSwiftCoverage” folder from DangerSwiftCoverage into","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"the “Sources\/Danger\/Plugins” folder in Danger Swift. If you cloned the two repos"},{"text":" ","type":"text"},{"type":"text","text":"next to each other, the copy command from the root of the Danger Swift repo"},{"type":"text","text":" "},{"type":"text","text":"would look like this:"}],"type":"paragraph"}]}],"type":"orderedList"},{"type":"codeListing","syntax":"sh","code":["cp -r ..\/danger-swift-coverage\/Sources\/DangerSwiftCoverage Sources\/Danger\/Plugins"]},{"start":4,"items":[{"content":[{"inlineContent":[{"type":"text","text":"Open Danger Swift’s Package.swift in Xcode and try to build the Danger"},{"text":" ","type":"text"},{"text":"library.","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Follow the compiler errors to fix all the build issues around multiple files","type":"text"},{"text":" ","type":"text"},{"text":"and types with conflicting names:","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Rename the file “Sources\/Danger\/DangerSwiftCoverage\/Models\/Report.swift”"},{"text":" ","type":"text"},{"type":"text","text":"to “Sources\/Danger\/DangerSwiftCoverage\/Models\/DangerSwiftCoverageReport.swift”"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Rename the "},{"code":"File","type":"codeVoice"},{"type":"text","text":" struct on line 34 of “XcodeBuildCoverage.swift” to"},{"type":"text","text":" "},{"code":"XcodeBuildCoverageFile","type":"codeVoice"},{"type":"text","text":" and update the type of "},{"code":"files","type":"codeVoice"},{"text":" on line 26 of the same","type":"text"},{"type":"text","text":" "},{"type":"text","text":"file to use the "},{"code":"XcodeBuildCoverageFile","type":"codeVoice"},{"text":" type.","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Remove the "},{"type":"codeVoice","code":"import Danger"},{"type":"text","text":" from the top of the “XcodeBuildCoverage.swift”"},{"type":"text","text":" "},{"text":"file.","type":"text"}],"type":"paragraph"}]}],"type":"orderedList"}]}],"type":"orderedList"},{"type":"paragraph","inlineContent":[{"type":"text","text":"OK, now we’ve integrated a plugin directly into the Danger library which means"},{"type":"text","text":" "},{"text":"that plugin will always be available in our Dangerfiles when linking against a","type":"text"},{"text":" ","type":"text"},{"text":"pre-built version of the library. Here are all the open source plugins I like","type":"text"},{"type":"text","text":" "},{"type":"text","text":"to include, and integrating them, or any others you may find, should follow the"},{"type":"text","text":" "},{"type":"text","text":"same steps as above:"}]},{"items":[{"content":[{"inlineContent":[{"overridingTitle":"DangerSwiftCoverage","identifier":"https:\/\/github.com\/f-meloni\/danger-swift-coverage","overridingTitleInlineContent":[{"text":"DangerSwiftCoverage","type":"text"}],"type":"reference","isActive":true},{"type":"text","text":" (mentioned above)"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"identifier":"https:\/\/github.com\/f-meloni\/danger-swift-xcodesummary","isActive":true,"type":"reference"},{"text":" (yes, Xcode is misspelled, but still a good plugin)","type":"text"}]}]}],"type":"unorderedList"},{"type":"heading","text":"Building a Portable Library","level":5,"anchor":"Building-a-Portable-Library"},{"inlineContent":[{"text":"As the Swift package is setup, there is no way to create a portable library. The","type":"text"},{"type":"text","text":" "},{"type":"text","text":"reason is that the "},{"type":"codeVoice","code":"swift build"},{"text":" command will not create a framework like we’re","type":"text"},{"type":"text","text":" "},{"text":"used to working with on iOS. Instead, it creates a folder full of object,","type":"text"},{"type":"text","text":" "},{"text":".swiftmodule, and .dylib files:","type":"text"}],"type":"paragraph"},{"type":"codeListing","syntax":"sh","code":["$ ls .build\/apple\/Products\/Release                 ","Danger-Swift.o                          Danger_Swift.swiftmodule    RunnerLib.o","Danger.o                                Logger.o                    RunnerLib.swiftmodule","Danger.swiftmodule                      Logger.swiftmodule          Version.o","DangerDependenciesResolver.o            OctoKit.o                   Version.swiftmodule","DangerDependenciesResolver.swiftmodule  OctoKit.swiftmodule         danger-swift","DangerFixtures.o                        PackageFrameworks           danger-swift.dSYM","DangerFixtures.swiftmodule              RequestKit.o                libDanger.dylib","DangerShellExecutor.o                   RequestKit.swiftmodule      libDanger.dylib.dSYM","DangerShellExecutor.swiftmodule         Runner.swiftmodule"]},{"type":"paragraph","inlineContent":[{"text":"This is not very portable. We need almost all of these files to be able to link","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"against libDanger.dylib. Plus, these files are tied to a specific Swift version"},{"text":" ","type":"text"},{"text":"because ","type":"text"},{"isActive":true,"identifier":"https:\/\/www.swift.org\/blog\/library-evolution\/","type":"reference"},{"text":" is","type":"text"},{"text":" ","type":"text"},{"text":"not turned on. This means that when you change the default version of Xcode on a","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"machine, and therefore change the default version of Swift, you’ll need to"},{"text":" ","type":"text"},{"type":"text","text":"rebuild the Danger Swift library. I’ve worked around this in the past by keeping"},{"type":"text","text":" "},{"type":"text","text":"an older version of Xcode on the build machines that is only used to run Danger"},{"type":"text","text":" "},{"type":"text","text":"Swift, but it is easy to forget why you’re doing that and inadvertently break"},{"type":"text","text":" "},{"text":"things.","type":"text"}]},{"style":"note","name":"Note","type":"aside","content":[{"type":"paragraph","inlineContent":[{"text":"It might be possible to use library evolution with this libDanger.dylib","type":"text"},{"text":" ","type":"text"},{"text":"and the object files, but I was not able to make it work.","type":"text"}]}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"To get a framework, which I find to be much more portable, you must use an Xcode"},{"type":"text","text":" "},{"type":"text","text":"project file, which I’ve added on this"},{"type":"text","text":" "},{"type":"reference","identifier":"https:\/\/github.com\/danger\/swift\/pull\/579","isActive":true},{"type":"text","text":". That pull request"},{"type":"text","text":" "},{"text":"also changes the Danger Swift library’s imports to be ","type":"text"},{"identifier":"https:\/\/forums.swift.org\/t\/update-on-implementation-only-imports\/26996","type":"reference","isActive":true},{"type":"text","text":" "},{"type":"text","text":"imports which tells the linker that the symbols within those imports won’t be"},{"type":"text","text":" "},{"text":"exposed publicly. And finally, that pull request tells the Danger Swift runner","type":"text"},{"type":"text","text":" "},{"type":"text","text":"to look for a “Danger.framework” to link against when running the Dangerfile."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Once that is done, you can run this command to generate the framework:"}]},{"type":"codeListing","syntax":"sh","code":["xcodebuild archive -project Danger.xcodeproj \\","  -scheme Danger -sdk macosx -destination \"generic\/platform=macOS\" \\","  -archivePath \"archives\/Danger.framework\""]},{"inlineContent":[{"text":"I’ve added a","type":"text"},{"text":" ","type":"text"},{"type":"reference","isActive":true,"identifier":"https:\/\/github.com\/danger\/swift\/pull\/579\/files#diff-ee93d24b11504c134791a4e4232fc7ccb850be02de509fd76431a30509bf675e"},{"text":".","type":"text"}],"type":"paragraph"},{"level":3,"anchor":"Using-this-Setup","text":"Using this Setup","type":"heading"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Now that we have an executable binary and a framework, how do we use them in our"},{"text":" ","type":"text"},{"type":"text","text":"CI jobs? Each of them is portable, so we can put them where we need them. I like"},{"type":"text","text":" "},{"type":"text","text":"to store all of my CI tooling in a centralized place, which I’ve talked about in"},{"type":"text","text":" "},{"type":"text","text":"my "},{"isActive":true,"type":"reference","overridingTitleInlineContent":[{"type":"text","text":"previous blog post on CI tooling"}],"overridingTitle":"previous blog post on CI tooling","identifier":"doc:\/\/Brunow\/documentation\/Brunow\/04-21-ci-tooling"},{"text":".","type":"text"}]},{"type":"paragraph","inlineContent":[{"text":"If you don’t want to, or can’t, use that centralized place, then you need to","type":"text"},{"type":"text","text":" "},{"type":"text","text":"make sure that the "},{"code":"danger-swift","type":"codeVoice"},{"text":" executable and the Danger.framework library","type":"text"},{"type":"text","text":" "},{"type":"text","text":"are in the same directory when you run "},{"code":"danger-swift","type":"codeVoice"},{"type":"text","text":"."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Once you have them there, you’ll want to do something like this in your CI job:"}]},{"syntax":"sh","code":["...","brew install node","npm install -g danger","danger-swift ci","..."],"type":"codeListing"}]}],"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/brunow\/04-22-how-i-like-to-use-danger"]}],"abstract":[{"type":"text","text":"Danger is an excellent tool for providing build tool feedback on pull requests"},{"text":" ","type":"text"},{"text":"with a flexible plugin architecture, but I find that limiting that flexibility","type":"text"},{"type":"text","text":" "},{"type":"text","text":"makes it more ergonomic."}],"schemaVersion":{"major":0,"patch":0,"minor":3},"references":{"https://danger.systems/swift/guides/getting_started":{"identifier":"https:\/\/danger.systems\/swift\/guides\/getting_started","type":"link","titleInlineContent":[{"type":"text","text":"the Danger Swift documentation"}],"title":"the Danger Swift documentation","url":"https:\/\/danger.systems\/swift\/guides\/getting_started"},"doc://Brunow/documentation/Brunow/04-21-ci-tooling":{"type":"topic","abstract":[{"text":"Storing CI tools in a centralized location to be used across the pipelines for","type":"text"},{"type":"text","text":" "},{"text":"multiple projects.","type":"text"}],"images":[{"type":"card","identifier":"allChecksHavePassed.png"}],"url":"\/documentation\/brunow\/04-21-ci-tooling","identifier":"doc:\/\/Brunow\/documentation\/Brunow\/04-21-ci-tooling","role":"article","title":"CI Tooling","kind":"article"},"https://danger.systems/swift/":{"identifier":"https:\/\/danger.systems\/swift\/","type":"link","titleInlineContent":[{"text":"Danger Swift’s documentation","type":"text"}],"title":"Danger Swift’s documentation","url":"https:\/\/danger.systems\/swift\/"},"doc://Brunow/documentation/Brunow/2024":{"kind":"article","identifier":"doc:\/\/Brunow\/documentation\/Brunow\/2024","url":"\/documentation\/brunow\/2024","role":"collectionGroup","abstract":[],"title":"2024","type":"topic"},"https://github.com/danger/swift/pull/579":{"identifier":"https:\/\/github.com\/danger\/swift\/pull\/579","type":"link","titleInlineContent":[{"type":"text","text":"proof of concept pull request for showing how to have a pre-built library that uses library evolution"}],"title":"proof of concept pull request for showing how to have a pre-built library that uses library evolution","url":"https:\/\/github.com\/danger\/swift\/pull\/579"},"https://github.com/f-meloni/danger-swift-xcodesummary":{"identifier":"https:\/\/github.com\/f-meloni\/danger-swift-xcodesummary","type":"link","titleInlineContent":[{"text":"DangerXCodeSummary","type":"text"}],"title":"DangerXCodeSummary","url":"https:\/\/github.com\/f-meloni\/danger-swift-xcodesummary"},"https://github.com/danger/swift/pull/579/files#diff-ee93d24b11504c134791a4e4232fc7ccb850be02de509fd76431a30509bf675e":{"identifier":"https:\/\/github.com\/danger\/swift\/pull\/579\/files#diff-ee93d24b11504c134791a4e4232fc7ccb850be02de509fd76431a30509bf675e","type":"link","titleInlineContent":[{"type":"text","text":"shell script on that pull request that builds both the runner and the library"}],"title":"shell script on that pull request that builds both the runner and the library","url":"https:\/\/github.com\/danger\/swift\/pull\/579\/files#diff-ee93d24b11504c134791a4e4232fc7ccb850be02de509fd76431a30509bf675e"},"allChecksHavePassed.png":{"variants":[{"traits":["1x","light"],"url":"\/images\/Brunow\/allChecksHavePassed@1x.png"}],"identifier":"allChecksHavePassed.png","type":"image","alt":"Screenshot of the GitHub interface showing that all CI checks have passed."},"https://www.swift.org/blog/library-evolution/":{"identifier":"https:\/\/www.swift.org\/blog\/library-evolution\/","type":"link","titleInlineContent":[{"type":"text","text":"library evolution"}],"title":"library evolution","url":"https:\/\/www.swift.org\/blog\/library-evolution\/"},"https://forums.swift.org/t/update-on-implementation-only-imports/26996":{"url":"https:\/\/forums.swift.org\/t\/update-on-implementation-only-imports\/26996","type":"link","titleInlineContent":[{"type":"codeVoice","code":"@_implementationOnly"}],"title":"@_implementationOnly","identifier":"https:\/\/forums.swift.org\/t\/update-on-implementation-only-imports\/26996"},"doc://Brunow/documentation/Brunow/Archive":{"title":"Archive","type":"topic","role":"collectionGroup","identifier":"doc:\/\/Brunow\/documentation\/Brunow\/Archive","kind":"article","url":"\/documentation\/brunow\/archive","abstract":[{"type":"text","text":"All posts"}]},"https://github.com/f-meloni/danger-swift-coverage":{"url":"https:\/\/github.com\/f-meloni\/danger-swift-coverage","type":"link","titleInlineContent":[{"type":"text","text":"DangerSwiftCoverage"}],"identifier":"https:\/\/github.com\/f-meloni\/danger-swift-coverage","title":"DangerSwiftCoverage"},"doc://Brunow/documentation/Brunow":{"role":"collection","url":"\/documentation\/brunow","identifier":"doc:\/\/Brunow\/documentation\/Brunow","title":"Brunow","type":"topic","kind":"symbol","abstract":[{"text":"David Brunow, known as Brunow [ˈbɹunoʊ] to the folks he works with, is a human living on Earth. You might have something in common with him — if you think it is ridiculous that he is talking about himself in the first person here, so does he.","type":"text"}]},"exampleDangerReport.png":{"variants":[{"traits":["1x","light"],"url":"\/images\/Brunow\/exampleDangerReport@1x.png"}],"identifier":"exampleDangerReport.png","type":"image","alt":null},"https://danger.systems/swift/guides/about_the_dangerfile#swift-package-manager-more-performant":{"identifier":"https:\/\/danger.systems\/swift\/guides\/about_the_dangerfile#swift-package-manager-more-performant","type":"link","titleInlineContent":[{"type":"text","text":"adding Danger Swift and any related plugins to your "},{"code":"Package.swift","type":"codeVoice"},{"type":"text","text":" file"}],"title":"adding Danger Swift and any related plugins to your Package.swift file","url":"https:\/\/danger.systems\/swift\/guides\/about_the_dangerfile#swift-package-manager-more-performant"}}}